"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[573,815],{18573:function(e,t,a){a.r(t);var s=a(4942),n=a(42982),c=a(74165),r=a(1413),i=a(15861),l=a(70885),u=a(72791),d=a(59930),o=a(2703),h=a(14717),m=a(19855),f=a(89102),v=a(28815),x=a(72426),p=a.n(x),_=a(80184);t.default=function(){var e=(0,h.useRouter)(),t=e.query.chatId,a=void 0===t?null:t,x=(0,h.useAuth)().user,j=(0,u.useState)({recent:[],favourite:[],group:[]}),N=(0,l.Z)(j,2),g=N[0],Z=N[1],C=(0,u.useState)(!0),k=(0,l.Z)(C,2),b=k[0],w=k[1],F=g.favourite,y=g.recent,A=g.group;(0,u.useEffect)((function(){f.socket.io&&x&&(f.socket.io.emit("join-room",x.id),f.socket.io.on("new-message",I))}),[]),(0,u.useEffect)((function(){S()}),[]);var S=function(){var e=(0,i.Z)((0,c.Z)().mark((function e(){var t,a,s,n,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=Promise,e.next=4,(0,m.getRecentChats)();case 4:return e.t1=e.sent,e.next=7,(0,m.getFavouriteChats)();case 7:return e.t2=e.sent,e.next=10,(0,m.getGroupChats)();case 10:return e.t3=e.sent,e.t4=[e.t1,e.t2,e.t3],e.next=14,e.t0.all.call(e.t0,e.t4);case 14:t=e.sent,a=(0,l.Z)(t,3),s=a[0],n=a[1],i=a[2],Z((0,r.Z)((0,r.Z)({},g),{},{recent:s.data.data,favourite:n.data.data,group:i.data.data})),e.next=25;break;case 22:e.prev=22,e.t5=e.catch(0),(0,d.Toast)({type:"error",message:null===e.t5||void 0===e.t5?void 0:e.t5.message});case 25:return e.prev=25,w(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[0,22,25,28]])})));return function(){return e.apply(this,arguments)}}(),z=function(t){t&&e.push("/chats/".concat(t))},I=function(e){console.log(e),Z((function(t){var a=e.type,c=(0,n.Z)(t[a]),i=c.findIndex((function(t){return t._id===e.chatId})),u=c.splice(i,1),d=(0,l.Z)(u,1)[0];return d.count+=1,(0,r.Z)((0,r.Z)({},t),{},(0,s.Z)({},a,[(0,r.Z)((0,r.Z)({},d),e)].concat((0,n.Z)(c))))}))},R=function(e){return e.split("T")[0]===(new Date).toISOString().split("T")[0]?p()(e).format("h:mm a"):p()(e).format("DD/MM/YY")};return b?(0,_.jsx)("div",{children:"Loading..."}):(0,_.jsxs)("div",{className:v.default.chat_list_container,children:[F.length>0&&(0,_.jsxs)(u.Fragment,{children:[(0,_.jsx)("div",{className:v.default.title,children:(0,_.jsx)("b",{children:"Favourites"})}),F.map((function(e,t){var n=e._id,c=e.count,r=e.msg,i=e.date,l=e.name,u=e.avatar,h=e.status;return(0,_.jsxs)("div",{className:(0,o.classNames)(v.default.user_card,(0,s.Z)({},v.default.active,n===a)),onClick:function(){return z(n)},children:[(0,_.jsxs)("div",{className:v.default.user,children:[(0,_.jsx)(d.Avatar,{src:u,name:l,status:h,size:35}),(0,_.jsxs)("div",{className:v.default.msg,children:[(0,_.jsx)("span",{className:"truncate-1",children:l}),(0,_.jsx)("span",{className:"truncate-2",children:r})]})]}),(0,_.jsxs)("div",{className:(0,o.classNames)(v.default.time,(0,s.Z)({},v.default.top,!c)),children:[(0,_.jsx)("span",{children:R(i)}),c>0&&(0,_.jsx)("label",{children:c})]})]},t)}))]}),y.length>0&&(0,_.jsxs)(u.Fragment,{children:[(0,_.jsx)("div",{className:v.default.title,children:(0,_.jsx)("b",{children:"Recent Chats"})}),y.map((function(e,t){var n=e._id,c=e.count,r=e.msg,i=e.date,l=e.name,u=e.avatar,h=e.status;return(0,_.jsxs)("div",{className:(0,o.classNames)(v.default.user_card,(0,s.Z)({},v.default.active,n===a)),onClick:function(){return z(n)},children:[(0,_.jsxs)("div",{className:v.default.user,children:[(0,_.jsx)(d.Avatar,{src:u,name:l,status:h,size:35}),(0,_.jsxs)("div",{className:v.default.msg,children:[(0,_.jsx)("span",{className:"truncate-1",children:l}),(0,_.jsx)("span",{className:"truncate-2",children:r})]})]}),(0,_.jsxs)("div",{className:(0,o.classNames)(v.default.time,(0,s.Z)({},v.default.top,!c)),children:[(0,_.jsx)("span",{children:R(i)}),c>0&&(0,_.jsx)("label",{children:c})]})]},t)}))]}),A.length>0&&(0,_.jsxs)(u.Fragment,{children:[(0,_.jsxs)("div",{className:v.default.title,children:[(0,_.jsx)("b",{children:"Groups"}),(0,_.jsx)("button",{children:(0,_.jsx)("i",{className:"bx-plus"})})]}),A.map((function(e,t){var n=e._id,c=e.count,r=e.msg,i=e.date,l=e.name,u=e.avatar;return(0,_.jsxs)("div",{className:(0,o.classNames)(v.default.user_card,(0,s.Z)({},v.default.active,n===a)),onClick:function(){return z(n)},children:[(0,_.jsxs)("div",{className:v.default.user,children:[(0,_.jsx)(d.Avatar,{src:u,name:l,size:35}),(0,_.jsxs)("div",{className:v.default.msg,children:[(0,_.jsx)("span",{className:"truncate-1",children:l}),(0,_.jsx)("span",{className:"truncate-2",children:r})]})]}),(0,_.jsxs)("div",{className:(0,o.classNames)(v.default.time,(0,s.Z)({},v.default.top,!c)),children:[(0,_.jsx)("span",{children:R(i)}),c>0&&(0,_.jsx)("label",{children:c})]})]},t)}))]})]})}},28815:function(e,t,a){a.r(t),t.default={chat_list_container:"Chats_chat_list_container__Lo8ht",title:"Chats_title__ncpOR",user_card:"Chats_user_card__m+jOS",active:"Chats_active__07HzW",user:"Chats_user__LeGpu",msg:"Chats_msg__y5EF6",time:"Chats_time__hAPQQ",top:"Chats_top__dpX3P"}}}]);
//# sourceMappingURL=573.a3b390db.chunk.js.map