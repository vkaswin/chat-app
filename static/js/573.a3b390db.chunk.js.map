{"version":3,"file":"static/js/573.a3b390db.chunk.js","mappings":"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","sources":["pages/Chats/index.js","webpack://react-chat-app/./src/pages/Chats/Chats.module.scss?1b4d"],"sourcesContent":["import React, { Fragment, useEffect, useRef, useState } from \"react\";\nimport { Avatar, Toast } from \"components\";\nimport { classNames } from \"utils\";\nimport { useAuth, useRouter } from \"hooks\";\nimport {\n  getFavouriteChats,\n  getRecentChats,\n  getGroupChats,\n} from \"services/Chat\";\nimport { socket } from \"socket\";\n\nimport styles from \"./Chats.module.scss\";\nimport moment from \"moment\";\n\nconst Chats = () => {\n  const router = useRouter();\n\n  const { chatId = null } = router.query;\n\n  const { user } = useAuth();\n\n  const [chatList, setChatList] = useState({\n    recent: [],\n    favourite: [],\n    group: [],\n  });\n\n  const [isLoading, setIsLoading] = useState(true);\n\n  const { favourite, recent, group } = chatList;\n\n  useEffect(() => {\n    if (!socket.io || !user) return;\n\n    socket.io.emit(\"join-room\", user.id);\n\n    socket.io.on(\"new-message\", handleNewMessage);\n  }, []);\n\n  useEffect(() => {\n    getChats();\n  }, []);\n\n  const getChats = async () => {\n    try {\n      let [recent, favourite, group] = await Promise.all([\n        await getRecentChats(),\n        await getFavouriteChats(),\n        await getGroupChats(),\n      ]);\n      setChatList({\n        ...chatList,\n        recent: recent.data.data,\n        favourite: favourite.data.data,\n        group: group.data.data,\n      });\n    } catch (error) {\n      Toast({ type: \"error\", message: error?.message });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleChat = (chatId) => {\n    if (!chatId) return;\n    router.push(`/chats/${chatId}`);\n  };\n\n  const handleNewMessage = (data) => {\n    console.log(data);\n    setChatList((prev) => {\n      const key = data.type;\n      const chats = [...prev[key]];\n      const index = chats.findIndex(({ _id }) => {\n        return _id === data.chatId;\n      });\n      const [element] = chats.splice(index, 1);\n      element.count += 1;\n      return {\n        ...prev,\n        [key]: [{ ...element, ...data }, ...chats],\n      };\n    });\n  };\n\n  const getDate = (date) => {\n    const isCurrentDate =\n      date.split(\"T\")[0] === new Date().toISOString().split(\"T\")[0];\n\n    return isCurrentDate\n      ? moment(date).format(\"h:mm a\")\n      : moment(date).format(\"DD/MM/YY\");\n  };\n\n  if (isLoading) return <div>Loading...</div>;\n\n  return (\n    <div className={styles.chat_list_container}>\n      {favourite.length > 0 && (\n        <Fragment>\n          <div className={styles.title}>\n            <b>Favourites</b>\n          </div>\n          {favourite.map(\n            ({ _id, count, msg, date, name, avatar, status }, index) => {\n              return (\n                <div\n                  key={index}\n                  className={classNames(styles.user_card, {\n                    [styles.active]: _id === chatId,\n                  })}\n                  onClick={() => handleChat(_id)}\n                >\n                  <div className={styles.user}>\n                    <Avatar\n                      src={avatar}\n                      name={name}\n                      status={status}\n                      size={35}\n                    />\n                    <div className={styles.msg}>\n                      <span className=\"truncate-1\">{name}</span>\n                      <span className=\"truncate-2\">{msg}</span>\n                    </div>\n                  </div>\n                  <div\n                    className={classNames(styles.time, {\n                      [styles.top]: !count,\n                    })}\n                  >\n                    <span>{getDate(date)}</span>\n                    {count > 0 && <label>{count}</label>}\n                  </div>\n                </div>\n              );\n            }\n          )}\n        </Fragment>\n      )}\n      {recent.length > 0 && (\n        <Fragment>\n          <div className={styles.title}>\n            <b>Recent Chats</b>\n          </div>\n          {recent.map(\n            ({ _id, count, msg, date, name, avatar, status }, index) => {\n              return (\n                <div\n                  key={index}\n                  className={classNames(styles.user_card, {\n                    [styles.active]: _id === chatId,\n                  })}\n                  onClick={() => handleChat(_id)}\n                >\n                  <div className={styles.user}>\n                    <Avatar\n                      src={avatar}\n                      name={name}\n                      status={status}\n                      size={35}\n                    />\n                    <div className={styles.msg}>\n                      <span className=\"truncate-1\">{name}</span>\n                      <span className=\"truncate-2\">{msg}</span>\n                    </div>\n                  </div>\n                  <div\n                    className={classNames(styles.time, {\n                      [styles.top]: !count,\n                    })}\n                  >\n                    <span>{getDate(date)}</span>\n                    {count > 0 && <label>{count}</label>}\n                  </div>\n                </div>\n              );\n            }\n          )}\n        </Fragment>\n      )}\n      {group.length > 0 && (\n        <Fragment>\n          <div className={styles.title}>\n            <b>Groups</b>\n            <button>\n              <i className=\"bx-plus\"></i>\n            </button>\n          </div>\n          {group.map(({ _id, count, msg, date, name, avatar }, index) => {\n            return (\n              <div\n                key={index}\n                className={classNames(styles.user_card, {\n                  [styles.active]: _id === chatId,\n                })}\n                onClick={() => handleChat(_id)}\n              >\n                <div className={styles.user}>\n                  <Avatar src={avatar} name={name} size={35} />\n                  <div className={styles.msg}>\n                    <span className=\"truncate-1\">{name}</span>\n                    <span className=\"truncate-2\">{msg}</span>\n                  </div>\n                </div>\n                <div\n                  className={classNames(styles.time, {\n                    [styles.top]: !count,\n                  })}\n                >\n                  <span>{getDate(date)}</span>\n                  {count > 0 && <label>{count}</label>}\n                </div>\n              </div>\n            );\n          })}\n        </Fragment>\n      )}\n    </div>\n  );\n};\n\nexport default Chats;\n","// extracted by mini-css-extract-plugin\nexport default {\"chat_list_container\":\"Chats_chat_list_container__Lo8ht\",\"title\":\"Chats_title__ncpOR\",\"user_card\":\"Chats_user_card__m+jOS\",\"active\":\"Chats_active__07HzW\",\"user\":\"Chats_user__LeGpu\",\"msg\":\"Chats_msg__y5EF6\",\"time\":\"Chats_time__hAPQQ\",\"top\":\"Chats_top__dpX3P\"};"],"names":["router","useRouter","query","chatId","user","useAuth","useState","recent","favourite","group","chatList","setChatList","isLoading","setIsLoading","useEffect","socket","id","handleNewMessage","getChats","Promise","getRecentChats","getFavouriteChats","getGroupChats","all","data","Toast","type","message","handleChat","push","console","log","prev","key","chats","index","findIndex","_id","splice","element","count","getDate","date","split","Date","toISOString","moment","format","className","styles","length","Fragment","map","msg","name","avatar","status","classNames","onClick","Avatar","src","size"],"sourceRoot":""}