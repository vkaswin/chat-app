"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[573,815],{18573:function(e,s,a){a.r(s);var t=a(4942),n=a(42982),c=a(74165),r=a(1413),i=a(15861),l=a(70885),u=a(72791),d=a(59930),m=a(2703),o=a(14717),h=a(19855),f=a(89102),v=a(28815),p=a(80184);s.default=function(){var e=(0,o.useRouter)(),s=e.query.chatId,a=void 0===s?null:s,x=(0,o.useAuth)().user,_=(0,u.useState)({recent:[],favourites:[],groups:[]}),j=(0,l.Z)(_,2),g=j[0],N=j[1],Z=(0,u.useState)(!0),C=(0,l.Z)(Z,2),k=C[0],b=C[1],w=g.favourites,A=g.recent,F=g.groups;(0,u.useEffect)((function(){f.socket.io&&x&&(f.socket.io.emit("join-room",x.id),f.socket.io.on("new-message",L))}),[]),(0,u.useEffect)((function(){y()}),[]);var y=function(){var e=(0,i.Z)((0,c.Z)().mark((function e(){var s,a,t,n,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=Promise,e.next=4,(0,h.getRecentChats)();case 4:return e.t1=e.sent,e.next=7,(0,h.getFavouriteChats)();case 7:return e.t2=e.sent,e.next=10,(0,h.getGroupChats)();case 10:return e.t3=e.sent,e.t4=[e.t1,e.t2,e.t3],e.next=14,e.t0.all.call(e.t0,e.t4);case 14:s=e.sent,a=(0,l.Z)(s,3),t=a[0],n=a[1],i=a[2],N((0,r.Z)((0,r.Z)({},g),{},{recent:t.data.data,favourites:n.data.data,groups:i.data.data})),e.next=25;break;case 22:e.prev=22,e.t5=e.catch(0),(0,d.Toast)({type:"error",message:null===e.t5||void 0===e.t5?void 0:e.t5.message});case 25:return e.prev=25,b(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[0,22,25,28]])})));return function(){return e.apply(this,arguments)}}(),I=function(s){s&&e.push("/chats/".concat(s))},L=function(e){N((function(s){var a=e.type,c=(0,n.Z)(s[a]),i=c.findIndex((function(s){return s._id===e.chatId})),u=c.splice(i,1),d=(0,l.Z)(u,1)[0];return d.message={date:e.date,msg:e.msg,seen:e.seen,_id:e._id,name:"Aswin"},d.count+=1,(0,r.Z)((0,r.Z)({},s),{},(0,t.Z)({},a,[d].concat((0,n.Z)(c))))}))};return k?(0,p.jsx)("div",{children:"Loading..."}):(0,p.jsxs)("div",{className:v.default.chat_list_container,children:[w.length>0&&(0,p.jsxs)(u.Fragment,{children:[(0,p.jsx)("div",{className:v.default.title,children:(0,p.jsx)("b",{children:"Favourites"})}),w.map((function(e,s){var n=e._id,c=e.count,r=e.message,i=(r=void 0===r?{}:r).msg,l=r.date,u=e.user,o=u.name,h=u.avatar,f=u.status;return(0,p.jsxs)("div",{className:(0,m.classNames)(v.default.user_card,(0,t.Z)({},v.default.active,n===a)),onClick:function(){return I(n)},children:[(0,p.jsxs)("div",{className:v.default.user,children:[(0,p.jsx)(d.Avatar,{src:h,name:o,status:f,size:35}),(0,p.jsxs)("div",{className:v.default.msg,children:[(0,p.jsx)("span",{className:"truncate-1",children:o}),(0,p.jsx)("span",{className:"truncate-2",children:i})]})]}),(0,p.jsxs)("div",{className:(0,m.classNames)(v.default.time,(0,t.Z)({},v.default.top,!c)),children:[(0,p.jsx)("span",{children:l}),c>0&&(0,p.jsx)("label",{children:c})]})]},s)}))]}),A.length>0&&(0,p.jsxs)(u.Fragment,{children:[(0,p.jsx)("div",{className:v.default.title,children:(0,p.jsx)("b",{children:"Recent Chats"})}),A.map((function(e,s){var n=e._id,c=e.count,r=e.message,i=(r=void 0===r?"":r).msg,l=e.user,u=l.name,o=l.avatar,h=l.status;return(0,p.jsxs)("div",{className:(0,m.classNames)(v.default.user_card,(0,t.Z)({},v.default.active,n===a)),onClick:function(){return I(n)},children:[(0,p.jsxs)("div",{className:v.default.user,children:[(0,p.jsx)(d.Avatar,{src:o,name:u,status:h,size:35}),(0,p.jsxs)("div",{className:v.default.msg,children:[(0,p.jsx)("span",{className:"truncate-1",children:u}),(0,p.jsx)("span",{className:"truncate-2",children:i})]})]}),(0,p.jsxs)("div",{className:(0,m.classNames)(v.default.time,(0,t.Z)({},v.default.top,!c)),children:[(0,p.jsx)("span",{children:"12:30 pm"}),c>0&&(0,p.jsx)("label",{children:c})]})]},s)}))]}),F.length>0&&(0,p.jsxs)(u.Fragment,{children:[(0,p.jsxs)("div",{className:v.default.title,children:[(0,p.jsx)("b",{children:"Groups"}),(0,p.jsx)("button",{children:(0,p.jsx)("i",{className:"bx-plus"})})]}),F.map((function(e,s){var n=e._id,c=e.count,r=(e.message,e.group,e.name),i=void 0===r?"Loreum Ipsum":r;return(0,p.jsxs)("div",{className:(0,m.classNames)(v.default.user_card,(0,t.Z)({},v.default.active,n===a)),onClick:function(){return I(n)},children:[(0,p.jsxs)("div",{className:v.default.user,children:[(0,p.jsx)(d.Avatar,{name:i,size:35}),(0,p.jsxs)("div",{className:v.default.msg,children:[(0,p.jsx)("span",{className:"truncate-1",children:i}),(0,p.jsx)("span",{className:"truncate-2",children:"Loreum Ipsum"})]})]}),(0,p.jsxs)("div",{className:(0,m.classNames)(v.default.time,(0,t.Z)({},v.default.top,!c)),children:[(0,p.jsx)("span",{children:"12:30 pm"}),c>0&&(0,p.jsx)("label",{children:c})]})]},s)}))]})]})}},28815:function(e,s,a){a.r(s),s.default={chat_list_container:"Chats_chat_list_container__Lo8ht",title:"Chats_title__ncpOR",user_card:"Chats_user_card__m+jOS",active:"Chats_active__07HzW",user:"Chats_user__LeGpu",msg:"Chats_msg__y5EF6",time:"Chats_time__hAPQQ",top:"Chats_top__dpX3P"}}}]);
//# sourceMappingURL=573.f019bd9a.chunk.js.map