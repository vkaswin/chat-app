"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[7352,101,4329,9599,2449,9855,3537,3487],{2775:function(e,t,n){n.r(t),n.d(t,{Conversation:function(){return d}});var r=n(4942),a=n(2791),o=n(9930),i=n(2703),s=n(2426),c=n.n(s),u=n(8527),l=n(184),d=function(e){var t=e.chats,n=e.onDelete,s=e.onCopy,d=e.onReply,f=e.userId,p=e.focusMsgById,m=e.otherUserId,h=e.unReadMsg;return(0,l.jsxs)(a.Fragment,{children:[t.map((function(e,t){var v=e.day,_=e.messages;return(0,l.jsxs)(a.Fragment,{children:[(0,l.jsx)("div",{className:u.default.date,children:(0,l.jsx)("span",{children:c()(v).format("D MMMM YYYY")})}),(0,l.jsx)("div",{className:u.default.container,children:_.map((function(e,v){var _=e.msg,x=e.date,j=e.sender,g=e._id,y=e.seen,b=e.reply,w=void 0===b?null:b;return(0,l.jsxs)(a.Fragment,{children:[h.id&&h.id===g&&(0,l.jsx)("div",{className:u.default.unread_msg,children:(0,l.jsxs)("span",{children:[h.total," Unread Message",h.total>1&&"s"]})}),(0,l.jsxs)("div",{className:(0,i.classNames)(u.default.chat_wrapper,(0,r.Z)({},u.default.end,f===j)),msgid:g,children:[(0,l.jsxs)("div",{className:u.default.chat_card,children:[w&&(0,l.jsx)("div",{className:u.default.reply_card,onClick:function(){return p(w._id,"smooth")},children:(0,l.jsx)("span",{children:w.msg})}),(0,l.jsx)("div",{children:(0,l.jsx)("span",{children:_})}),(0,l.jsxs)("div",{className:u.default.msg_time,children:[(0,l.jsx)("i",{className:"bx-time ".concat(u.default.clock)}),(0,l.jsx)("span",{children:c()(new Date(x)).format("h:mm a")}),(0,l.jsx)("i",{className:"bx bx-check-double ".concat(u.default.tick),seen:Array.isArray(m)?(y.length===m.length).toString():y.includes(m).toString()})]})]}),(0,l.jsxs)("div",{className:u.default.options,children:[(0,l.jsx)("i",{className:"bx-dots-vertical-rounded",id:"option-".concat(t).concat(v)}),(0,l.jsxs)(o.DropDown,{selector:"#option-".concat(t).concat(v),placement:"bottom",children:[(0,l.jsxs)(o.DropDownItem,{className:"dropdown-option",onClick:function(){return d(x,g)},children:[(0,l.jsx)("span",{children:"Reply"}),(0,l.jsx)("i",{className:"bx-share"})]}),(0,l.jsxs)(o.DropDownItem,{className:"dropdown-option",children:[(0,l.jsx)("span",{children:"Forward"}),(0,l.jsx)("i",{className:"bx-share-alt"})]}),(0,l.jsxs)(o.DropDownItem,{className:"dropdown-option",onClick:function(){return s(_)},children:[(0,l.jsx)("span",{children:"Copy"}),(0,l.jsx)("i",{className:"bx-copy"})]}),(0,l.jsxs)(o.DropDownItem,{className:"dropdown-option",children:[(0,l.jsx)("span",{children:"Mark as Unread"}),(0,l.jsx)("i",{className:"bx-message-error"})]}),(0,l.jsxs)(o.DropDownItem,{className:"dropdown-option",onClick:function(){return n(x,g)},children:[(0,l.jsx)("span",{children:"Delete"}),(0,l.jsx)("i",{className:"bx-trash"})]})]})]})]})]},v)}))})]},t)})),(0,l.jsx)("div",{className:u.default.typing,typingstatus:""})]})}},1256:function(e,t,n){n.r(t),n.d(t,{Header:function(){return c}});var r=n(2791),a=n(9930),o=n(2703),i=n(9041),s=n(184),c=function(e){var t,n=e.clearChatId,c=e.chatDetails,u=e.toggleInfo,l=e.handleCall,d=e.show,f=matchMedia("(max-width: 768px)").matches;return(0,s.jsxs)("div",{className:(0,o.classNames)(i.default.chat_header,d&&i.default.show),children:[(0,s.jsxs)("div",{className:i.default.user_info,children:[(0,s.jsx)("div",{className:i.default.go_back,onClick:n,children:(0,s.jsx)("i",{className:"bx bx-chevron-left"})}),(0,s.jsx)(a.Avatar,{src:null===c||void 0===c?void 0:c.avatar,name:null===c||void 0===c?void 0:c.name,size:50,status:null===c||void 0===c?void 0:c.status,userId:null===c||void 0===c?void 0:c.userId}),(0,s.jsxs)("div",{className:i.default.user_name,children:[(0,s.jsx)("b",{children:null===c||void 0===c?void 0:c.name}),(0,s.jsx)("span",{userid:null===c||void 0===c?void 0:c.userId,children:null!==c&&void 0!==c&&c.users?"".concat(null===c||void 0===c||null===(t=c.users)||void 0===t?void 0:t.length," Members"):null!==c&&void 0!==c&&c.status?"Online":"Offline"})]})]}),(0,s.jsxs)("div",{className:i.default.chat_icons,children:[(0,s.jsx)("i",{className:"bx-video",onClick:function(){return l("video")}}),(0,s.jsx)("i",{className:"bxs-info-circle",onClick:u}),(0,s.jsx)("i",{className:"bx-dots-vertical-rounded",id:"more-option"}),(0,s.jsxs)(a.DropDown,{selector:"#more-option",placement:"bottom-end",zIndex:2001,children:[f&&(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)(a.DropDownItem,{className:"dropdown-option",onClick:u,children:[(0,s.jsx)("span",{children:"View Profile"}),(0,s.jsx)("i",{className:"bx bx-user"})]}),(0,s.jsxs)(a.DropDownItem,{className:"dropdown-option",onClick:function(){return l("video")},children:[(0,s.jsx)("span",{children:"Video"}),(0,s.jsx)("i",{className:"bx bx-video"})]})]}),(0,s.jsxs)(a.DropDownItem,{className:"dropdown-option",children:[(0,s.jsx)("span",{children:"Muted"}),(0,s.jsx)("i",{className:"bx-microphone-off"})]}),(0,s.jsxs)(a.DropDownItem,{className:"dropdown-option",children:[(0,s.jsx)("span",{children:"Delete"}),(0,s.jsx)("i",{className:"bx-trash"})]})]})]})]})}},4273:function(e,t,n){n.r(t),n.d(t,{Loader:function(){return o}});n(2791);var r=n(67),a=n(184),o=function(){return(0,a.jsxs)("div",{className:r.default.loader,children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{}),(0,a.jsx)("div",{})]})}},3414:function(e,t,n){n.r(t),n.d(t,{PageLoader:function(){return i}});n(2791);var r=n(2703),a=n(22),o=n(184),i=function(){var e=["25%","27.5%","30%","32.5%","35%"],t=Array.from({length:10},(function(){return e[Math.floor(Math.random()*e.length)]}));return(0,o.jsx)("div",{className:a.default.container,children:t.map((function(e,t){return(0,o.jsxs)("div",{className:(0,r.classNames)(a.default.card,t%2===0&&a.default.end),style:{"--width":e},children:[(0,o.jsx)("div",{className:"".concat(a.default.line," skeleton")}),(0,o.jsx)("div",{className:"".concat(a.default.line," skeleton")})]},t)}))})}},8641:function(e,t,n){n.r(t),n.d(t,{Emoji:function(){return u}});var r=n(885),a=n(2791),o=n(9930),i=n(5357),s=n(517),c=n(184),u=function(e){var t=e.toggle,n=e.isOpen,u=e.selector,l=e.onChange,d=(0,a.useRef)(),f=function(e){return function(){l(e),t()}};return(0,c.jsx)(o.DropDown,{isOpen:n,toggle:t,selector:u,placement:"top-center",zIndex:2e3,children:(0,c.jsxs)("div",{className:s.default.emoji_container,children:[(0,c.jsxs)("div",{className:s.default.emoji_header,children:[[{label:"Smileys & People",icon:"bx-smile"},{label:"Animals & Nature",icon:"bx-leaf"},{label:"Travel & Places",icon:"bx-home-alt"},{label:"Activities",icon:"bx-baseball"},{label:"Objects",icon:"bx-world"},{label:"Symbols",icon:"bx-bulb"},{label:"Flags",icon:"bx-flag"}].map((function(e,t){var n,r=e.label,a=e.icon;return(0,c.jsxs)("div",{id:"emoji-type-".concat(t),className:s.default.emoji_type,onClick:(n=r,function(){var e=document.querySelector('[emoji-title="'.concat(n,'"]')).offsetTop;d.current.scrollTo(0,e-95)}),children:[(0,c.jsx)("i",{className:a}),(0,c.jsx)(o.Tooltip,{placement:"top",selector:"#emoji-type-".concat(t),offset:10,children:r})]},t)})),(0,c.jsxs)("div",{id:"emoji-close",className:s.default.close,onClick:t,children:[(0,c.jsx)("span",{children:"\u2a2f"}),(0,c.jsx)(o.Tooltip,{placement:"top",selector:"#emoji-close",offset:10,children:"Close"})]})]}),(0,c.jsxs)("div",{className:s.default.search_emoji,children:[(0,c.jsx)("input",{type:"text",placeholder:"Search Emoji"}),(0,c.jsx)("div",{className:s.default.search_icon,children:(0,c.jsx)("i",{className:"bx-search-alt-2"})})]}),(0,c.jsx)("div",{className:s.default.emoji_card,ref:d,children:Object.entries(i).map((function(e,t){var n=(0,r.Z)(e,2),a=n[0],o=n[1];return(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:s.default.emoji_title,"emoji-title":a,children:(0,c.jsx)("b",{children:a})}),(0,c.jsx)("div",{className:s.default.emoji_list,children:o.map((function(e,t){var n=e.emoji,r=e.description;return(0,c.jsx)("button",{title:r,onClick:f(n),children:(0,c.jsx)("div",{className:s.default.emoji_icon,children:n})},t)}))})]},t)}))})]})})}},1077:function(e,t,n){n.r(t),n.d(t,{TextArea:function(){return h}});var r=n(7762),a=n(4165),o=n(5861),i=n(885),s=n(2791),c=n(3487),u=n(8641),l=n(5145),d=n(2703),f=n(9102),p=n(8731),m=n(184),h=function(e){var t=e.onSend,n=e.onFocus,h=e.chatId,v=e.otherUser,_=(0,s.useState)(!1),x=(0,i.Z)(_,2),j=x[0],g=x[1],y=(0,s.useState)(""),b=(0,i.Z)(y,2),w=b[0],C=b[1],k=(0,s.useState)(),N=(0,i.Z)(k,2),Z=N[0],I=N[1],D=(0,s.useState)(!1),S=(0,i.Z)(D,2),E=S[0],T=S[1],M=(0,s.useRef)();(0,s.useEffect)((function(){var e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.interimResults=!0,e.continuous=!0,e.onstart=function(e){console.log(e)},e.onend=function(e){console.log(e)},e.onresult=function(e){var t=e.results,n=Array.from(t).map((function(e){return e[0]})).map((function(e){return e.transcript})).join("");C(w.concat(n))},e.onerror=function(e){console.log(e)},I(e)}),[]);var A=function(){return Array.isArray(v)?v.map((function(e){return{id:e._id,name:e.name}})):v},P=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(n=M.current.value).length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t(n);case 5:M.current.value="";case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,o,i,s,u,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.target.files,e.prev=1,o=new FormData,i=(0,r.Z)(n);try{for(i.s();!(s=i.n()).done;)u=s.value,o.append("file",u)}catch(a){i.e(a)}finally{i.f()}return e.next=7,(0,c.fileUpload)(o);case 7:d=e.sent,console.log(d),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),(0,l.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return(0,m.jsxs)(s.Fragment,{children:[(0,m.jsxs)("div",{className:p.default.chat_input,children:[(0,m.jsx)("i",{className:"bx-smile",id:"emoji"}),(0,m.jsxs)("div",{className:p.default.input_field,children:[(0,m.jsx)("textarea",{ref:M,placeholder:"Type your message...",name:"chat-input",onFocus:n,onKeyDown:function(){E||(f.socket.emit("start-typing",h,A()),T(!0))},onChange:(0,d.debounce)((function(){f.socket.emit("end-typing",h,A()),T(!1)}),1e3)}),(0,m.jsx)("label",{htmlFor:"chat-file",children:(0,m.jsx)("i",{className:"bx-paperclip",id:"attach"})}),(0,m.jsx)("input",{id:"chat-file",type:"file",onChange:R,multiple:!0,hidden:!0})]}),(0,m.jsx)("button",{onClick:P,children:(0,m.jsx)("i",{className:"bxs-send"})}),(0,m.jsx)("i",{className:"bx-microphone",id:"mic",onPointerDown:function(){null===Z||void 0===Z||Z.start()},onPointerUp:function(){null===Z||void 0===Z||Z.stop()}})]}),(0,m.jsx)(u.Emoji,{selector:"#emoji",isOpen:j,toggle:function(){g(!j)},onChange:function(e){C(w.concat(e))}})]})}},8325:function(e,t,n){n.r(t),n.d(t,{VideoPopup:function(){return i}});n(2791);var r=n(9930),a=n(2786),o=n(184),i=function(e){var t=e.isOpen;return(0,o.jsx)(r.Modal,{isOpen:t,width:750,closeClickOnOutside:!1,zIndex:2002,children:(0,o.jsxs)("div",{className:a.default.video_container,children:[(0,o.jsx)("video",{id:"local-stream",className:a.default.local,poster:"https://vue.pixelstrap.com/chitchat/_nuxt/img/videocall.336a27d.jpg",autoPlay:!0,muted:!0}),(0,o.jsx)("video",{id:"remote-stream",className:a.default.remote,poster:"https://vue.pixelstrap.com/chitchat/_nuxt/img/videocall_bg.ab164fb.jpg",autoPlay:!0})]})})}},7352:function(e,t,n){n.r(t),n.d(t,{Chat:function(){return D}});var r=n(4942),a=n(2982),o=n(4165),i=n(1413),s=n(5861),c=n(885),u=n(2791),l=n(9930),d=n(1077),f=n(1256),p=n(2775),m=n(8325),h=n(4717),v=n(3537),_=n(9855),x=n(2449),j=n(2703),g=n(5322),y=n(9102),b=n(4273),w=n(3414),C=n(101),k=n(4329),N=n(9961),Z=n(184),I=new Audio(C),D=function(){var e=(0,u.useRef)(),t=(0,u.useRef)(),n=(0,h.useAuth)(),C=n.user,D=n.chatId,S=n.clearChatId,E=(0,u.useRef)(),T=(0,u.useState)([]),M=(0,c.Z)(T,2),A=M[0],P=M[1],R=(0,u.useState)(!1),F=(0,c.Z)(R,2),O=F[0],L=F[1],H=(0,u.useState)(!1),q=(0,c.Z)(H,2),B=q[0],U=q[1],z=(0,u.useState)(null),Q=(0,c.Z)(z,2),V=Q[0],Y=Q[1],K=(0,u.useState)({}),G=(0,c.Z)(K,2),J=G[0],W=G[1],X=(0,u.useState)({}),$=(0,c.Z)(X,2),ee=$[0],te=$[1],ne=(0,u.useState)(!1),re=(0,c.Z)(ne,2),ae=re[0],oe=re[1],ie=(0,u.useState)(!1),se=(0,c.Z)(ie,2),ce=se[0],ue=se[1],le=(0,u.useState)({}),de=(0,c.Z)(le,2),fe=de[0],pe=de[1],me=(0,u.useState)(),he=(0,c.Z)(me,2),ve=he[0],_e=he[1],xe=(0,u.useRef)(),je=(0,u.useRef)();(0,u.useEffect)((function(){return document.addEventListener("socket",ge),function(){document.removeEventListener("socket",ge)}}),[]),(0,u.useEffect)((function(){0!==A.length&&P([]),Ce()}),[D]),(0,u.useEffect)((function(){xe.current&&0!==A.length&&Te(xe.current)}),[A]),(0,u.useEffect)((function(){xe.current&&!ve&&Te(xe.current)}),[ve]);var ge=function(){y.socket.on("message",Ae),y.socket.on("seen",Pe),y.socket.on("receive-offer",Be),y.socket.on("receive-answer",Ue),y.socket.on("start-typing",ye),y.socket.on("end-typing",be)},ye=function(t,n){var r=sessionStorage.getItem("chatId");if(r&&t===r&&e.current){var a=e.current.querySelector("[typingstatus]");a&&a.setAttribute("typing","".concat(n.split(" ")[0]," is typing..."))}},be=function(t){var n=sessionStorage.getItem("chatId");if(n&&t===n&&e.current){var r=e.current.querySelector("[typingstatus]");r&&r.removeAttribute("typing")}},we=function(){L(!O)},Ce=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n,r,a,s,u,d,f,p,m,h,x,j,g,y,b;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _e(!0),t=[],n=[],r={page:1,limit:50},e.prev=4,e.next=7,Promise.all([(0,_.getChatById)(D),(0,v.getMessagesByChatId)(D,r)]);case 7:if(a=e.sent,s=(0,c.Z)(a,2),u=s[0].data.data,d=s[1].data.data,f=d.list,p=void 0===f?[]:f,m=d.pageMeta,t=p,!u.messages){e.next=27;break}return e.next=18,(0,v.getMessagesByChatId)(D,{page:1,limit:10,type:"new"});case 18:h=e.sent,x=h.data.data,j=x.list,g=void 0===j?[]:j,y=x.pageMeta,n=Ze(t,g),pe((0,i.Z)({id:xe.current},y)),e.next=28;break;case 27:p.length>0&&(b=p[p.length-1].messages,xe.current=b[b.length-1]._id);case 28:te(u),W(m),P(t),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(4),(0,l.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 36:return e.prev=36,setTimeout((function(){var e;_e(!1),(null===(e=n)||void 0===e?void 0:e.length)>0&&De({msgId:n})}),100),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[4,33,36,39]])})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r,s,c,u,d,f,p,m,h=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:null,r=[],e.prev=2,s={limit:"new"===n?10:50,page:t,type:n},e.next=6,(0,v.getMessagesByChatId)(D,s);case 6:c=e.sent,u=c.data.data,d=u.list,f=u.pageMeta,"new"===n?(p=(0,a.Z)(A),r=Ze(p,d),P(p),pe((0,i.Z)((0,i.Z)({},fe),{},{totalPages:f.totalPages,page:f.page}))):Ne(d.reverse(),f),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),(0,l.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 16:return e.prev=16,"new"===n?ue(!1):oe(!1),(null===(m=r)||void 0===m?void 0:m.length)>0&&De({msgId:r}),e.finish(16);case 20:case"end":return e.stop()}}),e,null,[[2,13,16,20]])})));return function(t){return e.apply(this,arguments)}}(),Ne=function(e,t){P((function(t){var n=(0,a.Z)(t);return e.forEach((function(e,t){var r,o=e.day,i=e.messages,s=n.findIndex((function(e){var t=e.day;return o===t}));-1===s?n.unshift({day:o,messages:i}):(r=n[s].messages).unshift.apply(r,(0,a.Z)(i)),0===t&&(xe.current=i[i.length-1]._id)})),n})),W(t)},Ze=function(e,t){return t.forEach((function(n,r){var o,i=n.day,s=n.messages,c=e.findIndex((function(e){var t=e.day;return i===Oe(t)}));-1===c?e.push({day:i,messages:s}):(o=e[c].messages).push.apply(o,(0,a.Z)(s)),0===r&&(xe.current=t[0].messages[0]._id)})),t.reduce((function(e,t){var n=t.messages;return[].concat((0,a.Z)(e),(0,a.Z)(n.map((function(e){return e._id}))))}),[])},Ie=function(e,t,n){var r=e.findIndex((function(e){var t=e.day;return n===t}));-1===r?e.push({day:n,messages:[t]}):e[r].messages.push(t)},De=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(D){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,(0,_.markAsRead)(D,t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),Se=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,i.Z)({msg:t,date:(new Date).toISOString()},V&&{reply:V}),e.next=4,(0,v.createMessage)(D,n);case 4:r=e.sent,s=r.data.data,P((function(e){var t=(0,a.Z)(e);return Ie(t,s,Oe(s.date)),xe.current=s._id,t})),V&&Ee(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,l.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),Ee=function(){Y(null)},Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xe.current||null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";if(e){var n=document.querySelector("[msgid='".concat(e,"']"));n&&n.scrollIntoView({block:"center",behavior:t})}},Me=(0,u.useMemo)((function(){return null}),[V]),Ae=function(e){e.sender!==(null===C||void 0===C?void 0:C.id)&&(Fe(e.msg),Re(),P((function(t){var n=(0,a.Z)(t);return Ie(n,e,Oe(e.date)),xe.current=e._id,n})),De({msgId:e._id}))},Pe=function(e){var t=e.userId,n=e.msgId;if((null===C||void 0===C?void 0:C.id)!==t){var r=function(e){var t=document.querySelector("[msgid='".concat(e,"']"));t&&t.querySelector("[seen]").setAttribute("seen",!0)};Array.isArray(n)?n.forEach((function(e){r(e)})):r(n)}},Re=function(){I.muted=!1,I.play()},Fe=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("granted"===Notification.permission){e.next=2;break}return e.abrupt("return");case 2:new Notification("New Message",{body:t,icon:k});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Oe=function(e){return e.split("T")[0]},Le=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U(!0),e.prev=1,E.current=new RTCPeerConnection,E.current.onicecandidate=qe,E.current.ontrack=He,e.next=7,navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!0});case 7:return n=e.sent,document.querySelector("#local-stream").srcObject=n,n.getTracks().forEach((function(e){E.current.addTrack(e,n)})),e.next=13,E.current.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 13:return r=e.sent,e.next=16,E.current.setLocalDescription(r);case 16:return a={date:(new Date).toISOString(),offer:r,type:t},e.next=19,(0,x.initiateCall)(D,a);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),(0,l.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 24:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t){return e.apply(this,arguments)}}(),He=function(e){var t=(0,c.Z)(e.streams,1)[0];document.querySelector("#remote-stream").srcObject=t},qe=function(e){var t=e.target.localDescription,n=e.candidate;if(n&&(je.current=n),!n||!je.current)if("offer"===t.type){var r={offer:t,iceCandidate:je.current};y.socket.emit("send-offer",r,D)}else if("answer"===t.type){var a={answer:t,iceCandidate:je.current};y.socket.emit("send-answer",a,D)}},Be=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r,a,i,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iceCandidate,r=t.offer,U(!0),a=new RTCPeerConnection,E.current=a,E.current.onicecandidate=qe,E.current.ontrack=He,e.prev=6,e.next=9,navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!0});case 9:return i=e.sent,document.querySelector("#local-stream").srcObject=i,i.getTracks().forEach((function(e){E.current.addTrack(e,i)})),e.next=15,E.current.setRemoteDescription(r);case 15:return e.next=17,E.current.addIceCandidate(n);case 17:return e.next=19,E.current.createAnswer();case 19:return s=e.sent,e.next=22,E.current.setLocalDescription(s);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(6),console.log(e.t0);case 27:case"end":return e.stop()}}),e,null,[[6,24]])})));return function(t){return e.apply(this,arguments)}}(),Ue=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iceCandidate,r=t.answer,e.prev=1,e.next=4,E.current.setRemoteDescription(r);case 4:return e.next=6,E.current.addIceCandidate(n);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return(0,Z.jsxs)("div",{ref:e,className:N.default.chat_wrapper,onScroll:(0,j.debounce)((function(t){var n=t.target.scrollTop;if(!(ve||ae||ce)){if(0===n){var r=J.page,a=J.totalPages;if(r>=a)return;oe(!0),setTimeout((function(){return ke(r+1)}),500)}if(e.current.scrollHeight-e.current.scrollTop===e.current.clientHeight){var o=fe.page,i=void 0===o?null:o,s=fe.totalPages,c=void 0===s?null:s;if(!i||!c||i>=c)return;ue(!0),setTimeout((function(){return ke(i+1,"new")}),500)}}}),100),children:[(0,Z.jsx)(f.Header,{clearChatId:S,chatDetails:ee,handleCall:Le,toggleInfo:we,show:!!D}),ae&&(0,Z.jsx)(b.Loader,{}),(0,Z.jsx)("div",{className:N.default.chat_section,children:ve?(0,Z.jsx)(w.PageLoader,{}):(0,Z.jsx)(p.Conversation,{chats:A,onDelete:function(e,t){var n=Oe(e);if(A.hasOwnProperty(n)){var a=A[n].filter((function(e){var n=e._id;return t!==n}));P((0,i.Z)((0,i.Z)({},A),{},(0,r.Z)({},n,a)))}},onCopy:function(e){navigator.clipboard.writeText(e)},onReply:function(e,t){var n=Oe(e);Y({key:n,id:t})},userId:null===C||void 0===C?void 0:C.id,otherUserId:(null===ee||void 0===ee?void 0:ee.userId)||(null===ee||void 0===ee?void 0:ee.users),focusMsgById:Te,chatId:D,unReadMsg:fe})}),ce&&(0,Z.jsx)(b.Loader,{}),(0,Z.jsx)(d.TextArea,{onSend:Se,onFocus:function(){matchMedia("(max-width: 768px)").matches&&Te()},chatId:D,otherUser:null!==ee&&void 0!==ee&&ee.userId?{id:null===ee||void 0===ee?void 0:ee.userId,name:null===ee||void 0===ee?void 0:ee.name}:null===ee||void 0===ee?void 0:ee.users}),(0,Z.jsx)(g.Z,{in:Boolean(V),timeout:250,classNames:{enterActive:N.default.reply_enter,exitActive:N.default.reply_exit},unmountOnExit:!0,children:(0,Z.jsx)("div",{className:N.default.reply_container,ref:t,children:(0,Z.jsxs)("div",{className:N.default.reply_card,children:[(0,Z.jsx)("span",{className:"truncate-4",children:null===Me||void 0===Me?void 0:Me.msg}),(0,Z.jsx)("i",{className:"bx-x ".concat(N.default.close),onClick:Ee})]})})}),(0,Z.jsx)(l.OffCanvas,{isOpen:O,position:"right",className:N.default.profile_sidebar,toggle:we,zIndex:2001,children:(0,Z.jsx)("div",{children:"Hello"})}),(0,Z.jsx)(m.VideoPopup,{isOpen:B})]})}},2449:function(e,t,n){n.r(t),n.d(t,{getCallHistory:function(){return o},initiateCall:function(){return i}});var r=n(9599),a=n(77),o=function(){return(0,r.axios)({url:a.endpoints.call.history,method:"get"})},i=function(e,t){return(0,r.axios)({url:"".concat(a.endpoints.call.initiate,"/").concat(e),method:"post",data:t})}},9855:function(e,t,n){n.r(t),n.d(t,{addToFavourite:function(){return s},getChatById:function(){return i},getChatByType:function(){return o},markAsRead:function(){return u},removeFromFavourite:function(){return c}});var r=n(9599),a=n(77),o=function(e){return(0,r.axios)({url:"".concat(a.endpoints.chat.list,"/").concat(e),method:"get"})},i=function(e){return(0,r.axios)({url:"".concat(a.endpoints.chat.chatDetails,"/").concat(e),method:"get"})},s=function(e){return(0,r.axios)({url:a.endpoints.chat.addFavourite,method:"put"})},c=function(e){return(0,r.axios)({url:a.endpoints.chat.removeFavourite,method:"delete"})},u=function(e,t){return(0,r.axios)({url:"".concat(a.endpoints.chat.markAsRead,"/").concat(e),method:"put",data:t})}},3537:function(e,t,n){n.r(t),n.d(t,{createMessage:function(){return o},getMessagesByChatId:function(){return i}});var r=n(9599),a=n(77),o=function(e,t){return(0,r.axios)({url:"".concat(a.endpoints.message.createMessage,"/").concat(e),method:"post",data:t})},i=function(e,t){return(0,r.axios)({url:"".concat(a.endpoints.message.getMessages,"/").concat(e),method:"get",params:t})}},3487:function(e,t,n){n.r(t),n.d(t,{fileUpload:function(){return c},metaData:function(){return s}});var r=n(4165),a=n(5861),o=n(9599),i=n(77),s=(n(9930),function(e){var t;return(0,o.axios)({url:null===(t=i.endpoints.others)||void 0===t?void 0:t.metaData,method:"post",data:e})}),c=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.axios)({url:null===(n=i.endpoints.others)||void 0===n?void 0:n.fileUpload,method:"post",data:t}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},9599:function(e,t,n){n.r(t),n.d(t,{axios:function(){return s}});var r=n(4569),a=n.n(r),o=n(2703),i=n(77),s=a().create({baseURL:i.baseURL});s.interceptors.request.use((function(e){var t=(0,o.cookies)().get("authToken");return t&&(e.headers.Authorization=t),e}),(function(e){return Promise.reject(e)})),s.interceptors.response.use((function(e){return e}),(function(e){var t;return 401===e.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)}))},9961:function(e,t,n){n.r(t),t.default={chat_wrapper:"Chat_chat_wrapper__gid5u",chat_section:"Chat_chat_section__3JB1Y",chat_skeleton:"Chat_chat_skeleton__6w6um",reply_enter:"Chat_reply_enter__QdcSq","from-bottom":"Chat_from-bottom__yjlc1",reply_exit:"Chat_reply_exit__CEbB5",reply_container:"Chat_reply_container__Hj6fN",reply_card:"Chat_reply_card__6LYq6",close:"Chat_close__2-iqb",profile_sidebar:"Chat_profile_sidebar__DYbvp","zoom-in":"Chat_zoom-in__p3vEB"}},8527:function(e,t,n){n.r(t),t.default={container:"Conversation_container__I7CJi",chat_wrapper:"Conversation_chat_wrapper__S3O8R",end:"Conversation_end__ZMbi5",chat_card:"Conversation_chat_card__jz70L",reply_card:"Conversation_reply_card__AEy90",msg_time:"Conversation_msg_time__wN53F",tick:"Conversation_tick__RkyEe",clock:"Conversation_clock__y4n8i",options:"Conversation_options__WLSBI",date:"Conversation_date__ZfQTB",unread_msg:"Conversation_unread_msg__yFItk",typing:"Conversation_typing__Q3x0K",section:"Conversation_section__wG88I",load:"Conversation_load__rqCbg"}},9041:function(e,t,n){n.r(t),t.default={chat_header:"Header_chat_header__QpmQQ",user_info:"Header_user_info__iEHZa",go_back:"Header_go_back__lCP4K",user_name:"Header_user_name__Trw38",chat_icons:"Header_chat_icons__JOz6D",show:"Header_show__F368n"}},67:function(e,t,n){n.r(t),t.default={loader:"Loader_loader__gQpe+",rotation:"Loader_rotation__Q-TX-"}},22:function(e,t,n){n.r(t),t.default={container:"PageLoader_container__WEvcy",card:"PageLoader_card__Fmr-Q",end:"PageLoader_end__ahXWd",line:"PageLoader_line__y70Cl"}},517:function(e,t,n){n.r(t),t.default={emoji_enter:"Emoji_emoji_enter__hm4pK",emoji_container:"Emoji_emoji_container__FeFYJ",emoji_wrapper:"Emoji_emoji_wrapper__Mni-7","emoji-anime":"Emoji_emoji-anime__vboWK",emoji_exit:"Emoji_emoji_exit__yUFuv",emoji_header:"Emoji_emoji_header__HJTsc",emoji_type:"Emoji_emoji_type__Hmz-D",close:"Emoji_close__Tlf+A",search_emoji:"Emoji_search_emoji__QHZYs",search_icon:"Emoji_search_icon__EVS9p",emoji_card:"Emoji_emoji_card__cVAbK",emoji_title:"Emoji_emoji_title__uaqYB",emoji_list:"Emoji_emoji_list__zUunG",emoji_icon:"Emoji_emoji_icon__QGww2"}},8731:function(e,t,n){n.r(t),t.default={chat_input:"TextArea_chat_input__+dl6x",input_field:"TextArea_input_field__++nq-"}},2786:function(e,t,n){n.r(t),t.default={video_container:"VideoPopup_video_container__EcnPE",remote:"VideoPopup_remote__x1HvW",local:"VideoPopup_local__xIYkj"}},101:function(e,t,n){e.exports=n.p+"static/media/fade-in-tone.4355e6fe3e157d8945f6.mp3"},4329:function(e,t,n){e.exports=n.p+"static/media/favicon.6072f0ecd8b7685691ff.ico"}}]);
//# sourceMappingURL=7352.058adba1.chunk.js.map