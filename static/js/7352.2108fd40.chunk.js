"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[7352,101,4329,9961,2775,8527,714,2611,8263,1256,9041,4273,67,3414,22,5665,3693,3201,4302,1077,8641,517,8731,8325,2786,9599,2449,9855,3537,3487],{714:function(e,n,t){t.r(n),t.d(n,{Options:function(){return o}});t(2791);var r=t(9930),a=t(184),o=function(e){var n=e.onReply,t=e.onDelete,o=e.onCopy,s=e.selector,i=e.date,c=e.msgId,u=e.msg;return(0,a.jsxs)(r.DropDown,{selector:s,placement:"bottom",children:[(0,a.jsxs)(r.DropDownItem,{className:"dropdown-option",onClick:function(){return n(i,c)},children:[(0,a.jsx)("span",{children:"Reply"}),(0,a.jsx)("i",{className:"bx-share"})]}),(0,a.jsxs)(r.DropDownItem,{className:"dropdown-option",children:[(0,a.jsx)("span",{children:"Forward"}),(0,a.jsx)("i",{className:"bx-share-alt"})]}),(0,a.jsxs)(r.DropDownItem,{className:"dropdown-option",onClick:function(){return o(u)},children:[(0,a.jsx)("span",{children:"Copy"}),(0,a.jsx)("i",{className:"bx-copy"})]}),(0,a.jsxs)(r.DropDownItem,{className:"dropdown-option",children:[(0,a.jsx)("span",{children:"Mark as Unread"}),(0,a.jsx)("i",{className:"bx-message-error"})]}),(0,a.jsxs)(r.DropDownItem,{className:"dropdown-option",onClick:function(){return t(i,c)},children:[(0,a.jsx)("span",{children:"Delete"}),(0,a.jsx)("i",{className:"bx-trash"})]})]})}},2611:function(e,n,t){t.r(n),t.d(n,{Reaction:function(){return i}});t(2791);var r=t(9930),a=t(2703),o=t(8263),s=t(184),i=function(e){var n=e.reactions,t=e.selector,i=e.onClick;return(0,s.jsx)(r.DropDown,{selector:t,className:o.default.container,placement:"bottom",children:n.map((function(e,n){return(0,s.jsx)(r.DropDownItem,{className:o.default.wrapper,onClick:function(){return i(e)},children:(0,s.jsx)("img",{id:e,src:(0,a.getReactionUrl)(e)})},n)}))})}},2775:function(e,n,t){t.r(n),t.d(n,{Conversation:function(){return h}});var r=t(4942),a=t(1413),o=t(885),s=t(2791),i=t(2703),c=t(2611),u=t(714),l=t(2426),d=t.n(l),p=t(8527),f=t(5665),m=t(3201),v=t(184),h=function(e){var n=e.chats,t=e.onDelete,l=e.onCopy,h=e.onReply,_=e.userId,x=e.focusMsgById,j=e.users,g=e.unReadMsg,y=e.isGroupChat,b=e.reactionList,k=e.handleReaction,w=e.findMsgByMsgId,C=(0,s.useState)({}),N=(0,o.Z)(C,2),Z=N[0],I=N[1],D=(0,s.useState)({reaction:!1,seen:!1}),R=(0,o.Z)(D,2),S=R[0],M=R[1],E=function(e){var n=e.msgId,t=e.type;if(S[t])return M((0,a.Z)((0,a.Z)({},S),{},(0,r.Z)({},t,!1)));var o=w(n);o&&(I(o),M((0,a.Z)((0,a.Z)({},S),{},(0,r.Z)({},t,!0))))};return(0,v.jsxs)(s.Fragment,{children:[n.map((function(e,o){var f=e.day,m=e.messages;return(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:p.default.date,children:(0,v.jsx)("span",{children:d()(f).format("D MMMM YYYY")})}),(0,v.jsx)("div",{className:p.default.container,children:m.map((function(e,f){var w=e.msg,C=e.date,N=e.sender,Z=(N=void 0===N?{}:N).id,I=void 0===Z?null:Z,D=N.name,R=void 0===D?null:D,S=N.avatar,M=void 0===S?null:S,P=e._id,A=e.seen,T=e.reply,O=void 0===T?null:T,F=e.reactions,L=e.totalReactions;return(0,v.jsxs)(s.Fragment,{children:[g.id&&g.id===P&&(0,v.jsx)("div",{className:p.default.unread_msg,children:(0,v.jsxs)("span",{children:[g.total," Unread Message",g.total>1&&"s"]})}),(0,v.jsxs)("div",(0,a.Z)((0,a.Z)((0,a.Z)({className:(0,i.classNames)(p.default.chat_wrapper,(0,r.Z)({},p.default.end,_===I)),msgid:P},0===o&&0===f&&{first:""}),o===n.length-1&&f===m.length-1&&{last:""}),{},{children:[(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",(0,a.Z)((0,a.Z)({className:p.default.chat_card},_!==I&&{id:"reaction-".concat(P)}),{},{children:[O&&(0,v.jsx)("div",{className:p.default.reply_card,onClick:function(){return x(O._id,"smooth")},children:(0,v.jsx)("span",{children:O.msg})}),(0,v.jsxs)("div",{children:[y&&I!==_&&(0,v.jsx)("span",{style:{color:M},className:p.default.user_name,children:R.split(" ")[0]}),(0,v.jsx)("span",{children:w})]}),(0,v.jsxs)("div",{className:p.default.msg_time,children:[(0,v.jsx)("i",{className:"bx-time ".concat(p.default.clock)}),(0,v.jsx)("span",{children:d()(new Date(C)).format("h:mm a")}),(0,v.jsx)("i",{className:"bx bx-check-double ".concat(p.default.tick),seen:(A.length===j.length).toString(),onClick:function(e){e.stopPropagation(),console.log("seen"),E({msgId:P,type:"seen"})}})]})]})),(0,v.jsx)("div",{className:p.default.options,children:(0,v.jsx)("i",{className:"bx-dots-vertical-rounded",id:"option-".concat(P)})})]}),L>0&&(0,v.jsxs)("div",{className:p.default.reactions,onClick:function(){return E({msgId:P,type:"reaction"})},children:[F.map((function(e,n){var t=e.reaction;return(0,v.jsx)("img",{src:(0,i.getReactionUrl)(t)},n)})),(0,v.jsx)("span",{children:L})]})]})),(0,v.jsx)(u.Options,{selector:"#option-".concat(P),onCopy:l,onReply:h,onDelete:t,date:C,msgId:P,msg:w}),(0,v.jsx)(c.Reaction,{selector:"#reaction-".concat(P),reactions:b,onClick:function(e){return k(e,F,P)}})]},P)}))})]},o)})),(0,v.jsx)(f.default,{isOpen:S.reaction,message:Z,toggle:function(){return E({type:"reaction"})}}),(0,v.jsx)(m.default,{isOpen:S.seen,message:Z,toggle:function(){return E({type:"seen"})}})]})}},1256:function(e,n,t){t.r(n),t.d(n,{Header:function(){return c}});var r=t(2791),a=t(9930),o=t(2703),s=t(9041),i=t(184),c=function(e){var n,t=e.clearChatId,c=e.chatDetails,u=e.toggleInfo,l=e.handleCall,d=e.show,p=matchMedia("(max-width: 768px)").matches;return(0,i.jsxs)("div",{className:(0,o.classNames)(s.default.chat_header,d&&s.default.show),children:[(0,i.jsxs)("div",{className:s.default.user_info,children:[(0,i.jsx)("div",{className:s.default.go_back,onClick:t,children:(0,i.jsx)("i",{className:"bx bx-chevron-left"})}),(0,i.jsx)(a.Avatar,{src:null===c||void 0===c?void 0:c.avatar,name:null===c||void 0===c?void 0:c.name,size:50,status:null===c||void 0===c?void 0:c.status,userId:null===c||void 0===c?void 0:c.userId}),(0,i.jsxs)("div",{className:s.default.user_name,children:[(0,i.jsx)("b",{children:null===c||void 0===c?void 0:c.name}),(0,i.jsx)("span",{userid:null===c||void 0===c?void 0:c.userId,children:null!==c&&void 0!==c&&c.users?"".concat(null===c||void 0===c||null===(n=c.users)||void 0===n?void 0:n.length," Members"):null!==c&&void 0!==c&&c.status?"Online":"Offline"})]})]}),(0,i.jsxs)("div",{className:s.default.chat_icons,children:[(0,i.jsx)("i",{className:"bx-video",onClick:function(){return l("video")}}),(0,i.jsx)("i",{className:"bxs-info-circle",onClick:u}),(0,i.jsx)("i",{className:"bx-dots-vertical-rounded",id:"more-option"}),(0,i.jsxs)(a.DropDown,{selector:"#more-option",placement:"bottom-end",children:[p&&(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)(a.DropDownItem,{className:"dropdown-option",onClick:u,children:[(0,i.jsx)("span",{children:"View Profile"}),(0,i.jsx)("i",{className:"bx bx-user"})]}),(0,i.jsxs)(a.DropDownItem,{className:"dropdown-option",onClick:function(){return l("video")},children:[(0,i.jsx)("span",{children:"Video"}),(0,i.jsx)("i",{className:"bx bx-video"})]})]}),(0,i.jsxs)(a.DropDownItem,{className:"dropdown-option",children:[(0,i.jsx)("span",{children:"Muted"}),(0,i.jsx)("i",{className:"bx-microphone-off"})]}),(0,i.jsxs)(a.DropDownItem,{className:"dropdown-option",children:[(0,i.jsx)("span",{children:"Delete"}),(0,i.jsx)("i",{className:"bx-trash"})]})]})]})]})}},4273:function(e,n,t){t.r(n),t.d(n,{Loader:function(){return o}});t(2791);var r=t(67),a=t(184),o=function(){return(0,a.jsxs)("div",{className:r.default.loader,children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{}),(0,a.jsx)("div",{})]})}},3414:function(e,n,t){t.r(n),t.d(n,{PageLoader:function(){return s}});t(2791);var r=t(2703),a=t(22),o=t(184),s=function(){var e=["25%","27.5%","30%","32.5%","35%"],n=Array.from({length:10},(function(){return e[Math.floor(Math.random()*e.length)]}));return(0,o.jsx)("div",{className:a.default.container,children:n.map((function(e,n){return(0,o.jsxs)("div",{className:(0,r.classNames)(a.default.card,n%2===0&&a.default.end),style:{"--width":e},children:[(0,o.jsx)("div",{className:"".concat(a.default.line," skeleton")}),(0,o.jsx)("div",{className:"".concat(a.default.line," skeleton")})]},n)}))})}},5665:function(e,n,t){t.r(n);var r=t(885),a=t(2791),o=t(9930),s=t(2703),i=t(3693),c=t(184);n.default=function(e){var n,t=e.isOpen,u=e.toggle,l=e.message,d=(0,a.useState)(),p=(0,r.Z)(d,2),f=p[0],m=p[1],v=(0,a.useMemo)((function(){return l.hasOwnProperty("reactions")?0===f||f?l.reactions[f].users:l.reactions.reduce((function(e,n){var t=n.users;return e.concat(t)}),[]):[]}),[f,l]);return(0,c.jsx)(o.Modal,{isOpen:t,toggle:u,children:(0,c.jsxs)("div",{className:i.default.popup,children:[(0,c.jsxs)("div",{className:i.default.reactions,children:[(0,c.jsx)("div",{className:i.default.all,onClick:function(){return m()},children:(0,c.jsx)("span",{children:"All"})}),null===l||void 0===l||null===(n=l.reactions)||void 0===n?void 0:n.map((function(e,n){var t=e.reaction,r=e.total;return(0,c.jsxs)("div",{className:i.default.card,onClick:function(){return m(n)},children:[(0,c.jsx)("img",{src:(0,s.getReactionUrl)(t)}),(0,c.jsx)("span",{children:r})]},n)}))]}),(0,c.jsx)("div",{className:i.default.users,children:v.map((function(e,n){var t=e.avatar,r=(e.email,e.id),a=e.name,s=e.status;return(0,c.jsxs)("div",{className:i.default.card,children:[(0,c.jsx)(o.Avatar,{name:a,size:40,status:s,userId:r,src:t}),(0,c.jsx)("span",{children:a})]},n)}))})]})})}},3201:function(e,n,t){t.r(n);var r=t(2791),a=t(9930),o=t(4302),s=t(184);n.default=function(e){var n=e.isOpen,t=e.toggle,i=e.message,c=(0,r.useMemo)((function(){return i.hasOwnProperty("seen")?i.seen:[]}),[i]);return(0,s.jsx)(a.Modal,{isOpen:n,toggle:t,children:(0,s.jsxs)("div",{className:o.default.popup,children:[(0,s.jsx)("div",{className:o.default.reactions,children:(0,s.jsx)("div",{className:o.default.all,children:(0,s.jsx)("span",{children:"Seen"})})}),(0,s.jsx)("div",{className:o.default.users,children:c.map((function(e,n){var t=e.avatar,r=(e.email,e.id),i=e.name,c=e.status;return(0,s.jsxs)("div",{className:o.default.card,children:[(0,s.jsx)(a.Avatar,{name:i,size:40,status:c,userId:r,src:t}),(0,s.jsx)("span",{children:i})]},n)}))})]})})}},8641:function(e,n,t){t.r(n),t.d(n,{Emoji:function(){return u}});var r=t(885),a=t(2791),o=t(9930),s=t(5357),i=t(517),c=t(184),u=function(e){var n=e.toggle,t=e.isOpen,u=e.selector,l=e.onChange,d=(0,a.useRef)(),p=function(e){return function(){l(e),n()}};return(0,c.jsx)(o.DropDown,{isOpen:t,toggle:n,selector:u,placement:"top-center",children:(0,c.jsxs)("div",{className:i.default.emoji_container,children:[(0,c.jsxs)("div",{className:i.default.emoji_header,children:[[{label:"Smileys & People",icon:"bx-smile"},{label:"Animals & Nature",icon:"bx-leaf"},{label:"Travel & Places",icon:"bx-home-alt"},{label:"Activities",icon:"bx-baseball"},{label:"Objects",icon:"bx-world"},{label:"Symbols",icon:"bx-bulb"},{label:"Flags",icon:"bx-flag"}].map((function(e,n){var t,r=e.label,a=e.icon;return(0,c.jsxs)("div",{id:"emoji-type-".concat(n),className:i.default.emoji_type,onClick:(t=r,function(){var e=document.querySelector('[emoji-title="'.concat(t,'"]')).offsetTop;d.current.scrollTo(0,e-95)}),children:[(0,c.jsx)("i",{className:a}),(0,c.jsx)(o.Tooltip,{placement:"top",selector:"#emoji-type-".concat(n),offset:10,children:r})]},n)})),(0,c.jsxs)("div",{id:"emoji-close",className:i.default.close,onClick:n,children:[(0,c.jsx)("span",{children:"\u2a2f"}),(0,c.jsx)(o.Tooltip,{placement:"top",selector:"#emoji-close",offset:10,children:"Close"})]})]}),(0,c.jsxs)("div",{className:i.default.search_emoji,children:[(0,c.jsx)("input",{type:"text",placeholder:"Search Emoji"}),(0,c.jsx)("div",{className:i.default.search_icon,children:(0,c.jsx)("i",{className:"bx-search-alt-2"})})]}),(0,c.jsx)("div",{className:i.default.emoji_card,ref:d,children:Object.entries(s).map((function(e,n){var t=(0,r.Z)(e,2),a=t[0],o=t[1];return(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:i.default.emoji_title,"emoji-title":a,children:(0,c.jsx)("b",{children:a})}),(0,c.jsx)("div",{className:i.default.emoji_list,children:o.map((function(e,n){var t=e.emoji,r=e.description;return(0,c.jsx)("button",{title:r,onClick:p(t),children:(0,c.jsx)("div",{className:i.default.emoji_icon,children:t})},n)}))})]},n)}))})]})})}},1077:function(e,n,t){t.r(n),t.d(n,{TextArea:function(){return v}});var r=t(7762),a=t(4165),o=t(5861),s=t(885),i=t(2791),c=t(3487),u=t(8641),l=t(5145),d=t(2703),p=t(9102),f=t(8731),m=t(184),v=function(e){var n=e.onSend,t=e.onFocus,v=e.chatId,h=e.otherUser,_=(0,i.useState)(!1),x=(0,s.Z)(_,2),j=x[0],g=x[1],y=(0,i.useState)(""),b=(0,s.Z)(y,2),k=b[0],w=b[1],C=(0,i.useState)(),N=(0,s.Z)(C,2),Z=N[0],I=N[1],D=(0,i.useState)(!1),R=(0,s.Z)(D,2),S=R[0],M=R[1],E=(0,i.useRef)();(0,i.useEffect)((function(){var e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.interimResults=!0,e.continuous=!0,e.onstart=function(e){console.log(e)},e.onend=function(e){console.log(e)},e.onresult=function(e){var n=e.results,t=Array.from(n).map((function(e){return e[0]})).map((function(e){return e.transcript})).join("");w(k.concat(t))},e.onerror=function(e){console.log(e)},I(e)}),[]);var P=function(){return console.log(h),Array.isArray(h)?h.map((function(e){return{id:e._id,name:e.name}})):h},A=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=E.current.value).length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n(t);case 5:E.current.value="";case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(n){var t,o,s,i,u,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.target.files,e.prev=1,o=new FormData,s=(0,r.Z)(t);try{for(s.s();!(i=s.n()).done;)u=i.value,o.append("file",u)}catch(a){s.e(a)}finally{s.f()}return e.next=7,(0,c.fileUpload)(o);case 7:d=e.sent,console.log(d),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),(0,l.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(n){return e.apply(this,arguments)}}();return(0,m.jsxs)(i.Fragment,{children:[(0,m.jsxs)("div",{className:f.default.chat_input,children:[(0,m.jsx)("i",{className:"bx-smile",id:"emoji"}),(0,m.jsxs)("div",{className:f.default.input_field,children:[(0,m.jsx)("textarea",{ref:E,placeholder:"Type your message...",name:"chat-input",onFocus:t,onKeyDown:function(){S||(p.socket.emit("start-typing",v,P()),M(!0))},onChange:(0,d.debounce)((function(){p.socket.emit("end-typing",v,P()),M(!1)}),1e3)}),(0,m.jsx)("label",{htmlFor:"chat-file",children:(0,m.jsx)("i",{className:"bx-paperclip",id:"attach"})}),(0,m.jsx)("input",{id:"chat-file",type:"file",onChange:T,multiple:!0,hidden:!0})]}),(0,m.jsx)("button",{onClick:A,children:(0,m.jsx)("i",{className:"bxs-send"})}),(0,m.jsx)("i",{className:"bx-microphone",id:"mic",onPointerDown:function(){null===Z||void 0===Z||Z.start()},onPointerUp:function(){null===Z||void 0===Z||Z.stop()}})]}),(0,m.jsx)(u.Emoji,{selector:"#emoji",isOpen:j,toggle:function(){g(!j)},onChange:function(e){w(k.concat(e))}})]})}},8325:function(e,n,t){t.r(n),t.d(n,{VideoPopup:function(){return s}});t(2791);var r=t(9930),a=t(2786),o=t(184),s=function(e){var n=e.isOpen;return(0,o.jsx)(r.Modal,{isOpen:n,width:750,closeClickOnOutside:!1,zIndex:2002,children:(0,o.jsxs)("div",{className:a.default.video_container,children:[(0,o.jsx)("video",{id:"local-stream",className:a.default.local,poster:"https://vue.pixelstrap.com/chitchat/_nuxt/img/videocall.336a27d.jpg",autoPlay:!0,muted:!0}),(0,o.jsx)("video",{id:"remote-stream",className:a.default.remote,poster:"https://vue.pixelstrap.com/chitchat/_nuxt/img/videocall_bg.ab164fb.jpg",autoPlay:!0})]})})}},7352:function(e,n,t){t.r(n),t.d(n,{Chat:function(){return R}});var r=t(7762),a=t(4942),o=t(1413),s=t(2982),i=t(4165),c=t(5861),u=t(885),l=t(2791),d=t(9930),p=t(1077),f=t(1256),m=t(2775),v=t(8325),h=t(4717),_=t(3537),x=t(9855),j=t(2449),g=t(2703),y=t(5322),b=t(9102),k=t(4273),w=t(3414),C=t(101),N=t(4329),Z=t(9961),I=t(184),D=new Audio(C),R=function(e){var n=e.reactions,t=(0,l.useRef)(),C=(0,l.useRef)(),R=(0,h.useAuth)(),S=R.user,M=R.chatId,E=R.clearChatId,P=(0,l.useRef)(),A=(0,l.useState)([]),T=(0,u.Z)(A,2),O=T[0],F=T[1],L=(0,l.useState)(!1),B=(0,u.Z)(L,2),H=B[0],U=B[1],q=(0,l.useState)(!1),z=(0,u.Z)(q,2),V=z[0],Y=z[1],Q=(0,l.useState)(null),G=(0,u.Z)(Q,2),J=G[0],K=G[1],W=(0,l.useState)({}),X=(0,u.Z)(W,2),$=X[0],ee=X[1],ne=(0,l.useState)(!1),te=(0,u.Z)(ne,2),re=te[0],ae=te[1],oe=(0,l.useState)(!1),se=(0,u.Z)(oe,2),ie=se[0],ce=se[1],ue=(0,l.useState)({}),le=(0,u.Z)(ue,2),de=le[0],pe=le[1],fe=(0,l.useState)(!0),me=(0,u.Z)(fe,2),ve=me[0],he=me[1],_e=(0,l.useState)(!1),xe=(0,u.Z)(_e,2),je=xe[0],ge=xe[1],ye=(0,l.useState)(!1),be=(0,u.Z)(ye,2),ke=be[0],we=be[1],Ce=(0,l.useRef)(),Ne=(0,l.useRef)();(0,l.useEffect)((function(){return document.addEventListener("socket",Ze),function(){document.removeEventListener("socket",Ze)}}),[]),(0,l.useEffect)((function(){0!==O.length&&F([]),Se()}),[M]),(0,l.useEffect)((function(){Ce.current&&0!==O.length&&Fe(Ce.current)}),[O]),(0,l.useEffect)((function(){Ce.current&&!ve&&Fe(Ce.current)}),[ve]);var Ze=function(){b.socket.on("message",Be),b.socket.on("seen",He),b.socket.on("receive-offer",We),b.socket.on("receive-answer",Xe),b.socket.on("start-typing",Ie),b.socket.on("end-typing",De)},Ie=function(e,n){var r=sessionStorage.getItem("chatId");if(r&&e===r&&t.current){var a=t.current.querySelector("[typingstatus]");a&&a.setAttribute("typing","".concat(n.split(" ")[0]," is typing..."))}},De=function(e){var n=sessionStorage.getItem("chatId");if(n&&e===n&&t.current){var r=t.current.querySelector("[typingstatus]");r&&r.removeAttribute("typing")}},Re=function(){U(!H)},Se=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(){var n,t,r,a,o,s,c,u,l,p,f,m,v,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return he(!0),e.prev=1,e.next=4,(0,x.getChatById)(M,{limit:50});case 4:if(n=e.sent,t=n.data.data,r=t.chatDetails,a=void 0===r?{}:r,o=t.unReadMsgList,s=void 0===o?[]:o,c=t.msgList,u=void 0===c?[]:c,l=t.hasMoreTop,p=void 0!==l&&l,f=t.hasMoreBottom,m=void 0!==f&&f,v=t.totalUnReadMsg,h=void 0===v?0:v,!(s.length>0)){e.next=27;break}return Ce.current=s[0].messages[0]._id,Pe(u,s),pe({id:Ce.current,total:h}),we(m),e.next=25,(0,x.markAsRead)(M);case 25:e.next=28;break;case 27:u.length>0&&(Ce.current=u.at(-1).messages.at(-1)._id);case 28:ee(a),F(u),ge(p),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(1),(0,d.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 36:return e.prev=36,he(!1),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[1,33,36,39]])})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n,t){var r,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,x.getChatMessagesByMsgId)(M,n,{limit:50,latest:t});case 3:r=e.sent,a=r.data.data,o=a.list,c=a.hasMore,u=(0,s.Z)(O),t?Pe(u,o):Ee(u,o.reverse()),F(u),t?we(c):ge(c),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),(0,d.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 16:return e.prev=16,t?ce(!1):ae(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})));return function(n,t){return e.apply(this,arguments)}}(),Ee=function(e,n){n.forEach((function(n,t){var r,a=n.day,o=n.messages,i=e.findIndex((function(e){var n=e.day;return a===n}));-1===i?e.unshift({day:a,messages:o}):(r=e[i].messages).unshift.apply(r,(0,s.Z)(o)),0===t&&(Ce.current=o[o.length-1]._id)}))},Pe=function(e,n){n.forEach((function(t,r){var a,o=t.day,i=t.messages,c=e.findIndex((function(e){var n=e.day;return o===Qe(n)}));-1===c?e.push({day:o,messages:i}):(a=e[c].messages).push.apply(a,(0,s.Z)(i)),0===r&&(Ce.current=n[0].messages[0]._id)}))},Ae=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,(0,x.markAsReadByMsgId)(M,n);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(n){return e.apply(this,arguments)}}(),Te=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,o.Z)({msg:n,date:(new Date).toISOString()},J&&{reply:J}),e.next=4,(0,_.createMessage)(M,t);case 4:J&&Oe(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,d.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),Oe=function(){K(null)},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ce.current||null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";if(e){var t=document.querySelector("[msgid='".concat(e,"']"));t&&t.scrollIntoView({block:"center",behavior:n})}},Le=(0,l.useMemo)((function(){return null}),[J]),Be=function(e){var n=e.message,t=e.chat,r=e.userId;F((function(e){Ye(n.msg),Ve();var a=(0,s.Z)(e);return function(e,n,t){var r=e.findIndex((function(e){var n=e.day;return t===n}));-1===r?e.push({day:t,messages:[n]}):e[r].messages.push(n)}(a,n,Qe(n.date)),Ce.current=n._id,n.sender.id!==r&&sessionStorage.getItem("chatId")===t._id&&Ae(n._id),a}))},He=function(e){var n=e.userId,t=e.msgId;if((null===S||void 0===S?void 0:S.id)!==n){var r=function(e){var n=document.querySelector("[msgid='".concat(e,"']"));n&&n.querySelector("[seen]").setAttribute("seen",!0)};Array.isArray(t)?t.forEach((function(e){var n=e.id;r(n)})):r(t)}},Ue=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n,t,a){var o,s,c,l,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=(0,r.Z)(t.entries()),e.prev=1,s.s();case 3:if((c=s.n()).done){e.next=10;break}if(l=(0,u.Z)(c.value,2),l[0],d=l[1].users,!(o=d.find((function(e,n){var t=e.id;return S.id===t})))){e.next=8;break}return e.abrupt("break",10);case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),s.e(e.t0);case 15:return e.prev=15,s.f(),e.finish(15);case 18:o?ze({reaction:n,id:o.reactionId}):qe({reaction:n,msgId:a});case 19:case"end":return e.stop()}}),e,null,[[1,12,15,18]])})));return function(n,t,r){return e.apply(this,arguments)}}(),qe=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,x.createReaction)(n);case 3:t=e.sent,console.log(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,d.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),ze=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,x.updateReaction)(n);case 3:t=e.sent,console.log(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,d.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),Ve=function(){D.muted=!1,D.play()},Ye=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("granted"===Notification.permission){e.next=2;break}return e.abrupt("return");case 2:new Notification("New Message",{body:n,icon:N});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Qe=function(e){return e.split("T")[0]},Ge=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){var t,r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y(!0),e.prev=1,P.current=new RTCPeerConnection,P.current.onicecandidate=Ke,P.current.ontrack=Je,e.next=7,navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!0});case 7:return t=e.sent,document.querySelector("#local-stream").srcObject=t,t.getTracks().forEach((function(e){P.current.addTrack(e,t)})),e.next=13,P.current.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 13:return r=e.sent,e.next=16,P.current.setLocalDescription(r);case 16:return a={date:(new Date).toISOString(),offer:r,type:n},e.next=19,(0,j.initiateCall)(M,a);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),(0,d.Toast)({type:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 24:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(n){return e.apply(this,arguments)}}(),Je=function(e){var n=(0,u.Z)(e.streams,1)[0];document.querySelector("#remote-stream").srcObject=n},Ke=function(e){var n=e.target.localDescription,t=e.candidate;if(t&&(Ne.current=t),!t||!Ne.current)if("offer"===n.type){var r={offer:n,iceCandidate:Ne.current};b.socket.emit("send-offer",r,M)}else if("answer"===n.type){var a={answer:n,iceCandidate:Ne.current};b.socket.emit("send-answer",a,M)}},We=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){var t,r,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.iceCandidate,r=n.offer,Y(!0),a=new RTCPeerConnection,P.current=a,P.current.onicecandidate=Ke,P.current.ontrack=Je,e.prev=6,e.next=9,navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!0});case 9:return o=e.sent,document.querySelector("#local-stream").srcObject=o,o.getTracks().forEach((function(e){P.current.addTrack(e,o)})),e.next=15,P.current.setRemoteDescription(r);case 15:return e.next=17,P.current.addIceCandidate(t);case 17:return e.next=19,P.current.createAnswer();case 19:return s=e.sent,e.next=22,P.current.setLocalDescription(s);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(6),console.log(e.t0);case 27:case"end":return e.stop()}}),e,null,[[6,24]])})));return function(n){return e.apply(this,arguments)}}(),Xe=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(n){var t,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.iceCandidate,r=n.answer,e.prev=1,e.next=4,P.current.setRemoteDescription(r);case 4:return e.next=6,P.current.addIceCandidate(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(n){return e.apply(this,arguments)}}();return(0,I.jsxs)("div",{ref:t,className:Z.default.chat_wrapper,onScroll:(0,g.debounce)((function(e){var n=e.target,r=n.scrollTop,a=n.scrollHeight,o=n.clientHeight;if(!(ve||re||ie)){if(je&&0===r){var s=t.current.querySelector("[first]").getAttribute("msgid");ae(!0),Me(s,0)}if(ke&&a-r===o){var i=t.current.querySelector("[last]").getAttribute("msgid");ce(!0),Me(i,1)}}}),100),children:[(0,I.jsx)(f.Header,{clearChatId:E,chatDetails:$,handleCall:Ge,toggleInfo:Re,show:!!M}),re&&(0,I.jsx)(k.Loader,{}),(0,I.jsx)("div",{id:"conversation",className:Z.default.chat_section,children:ve?(0,I.jsx)(w.PageLoader,{}):(0,I.jsx)(m.Conversation,{chats:O,onDelete:function(e,n){var t=Qe(e);if(O.hasOwnProperty(t)){var r=O[t].filter((function(e){var t=e._id;return n!==t}));F((0,o.Z)((0,o.Z)({},O),{},(0,a.Z)({},t,r)))}},onCopy:function(e){navigator.clipboard.writeText(e)},onReply:function(e,n){var t=Qe(e);K({key:t,id:n})},userId:null===S||void 0===S?void 0:S.id,users:null===$||void 0===$?void 0:$.users,focusMsgById:Fe,chatId:M,unReadMsg:de,isGroupChat:!(null===$||void 0===$||!$.group),reactionList:n,handleReaction:Ue,findMsgByMsgId:function(e){var n,t,a=(0,r.Z)(O);try{for(a.s();!(t=a.n()).done;){if(n=t.value.messages.find((function(n){return n._id===e})))break}}catch(o){a.e(o)}finally{a.f()}if(n)return n}})}),(0,I.jsx)("div",{className:Z.default.typing,typingstatus:""}),ie&&(0,I.jsx)(k.Loader,{}),(0,I.jsx)(p.TextArea,{onSend:Te,onFocus:function(){matchMedia("(max-width: 768px)").matches&&Fe()},chatId:M,otherUser:null!==$&&void 0!==$&&$.userId?{id:null===$||void 0===$?void 0:$.userId,name:null===$||void 0===$?void 0:$.name}:null===$||void 0===$?void 0:$.users}),(0,I.jsx)(y.Z,{in:Boolean(J),timeout:250,classNames:{enterActive:Z.default.reply_enter,exitActive:Z.default.reply_exit},unmountOnExit:!0,children:(0,I.jsx)("div",{className:Z.default.reply_container,ref:C,children:(0,I.jsxs)("div",{className:Z.default.reply_card,children:[(0,I.jsx)("span",{className:"truncate-4",children:null===Le||void 0===Le?void 0:Le.msg}),(0,I.jsx)("i",{className:"bx-x ".concat(Z.default.close),onClick:Oe})]})})}),(0,I.jsx)(d.OffCanvas,{isOpen:H,position:"right",className:Z.default.profile_sidebar,toggle:Re,zIndex:2001,children:(0,I.jsx)("div",{children:"Hello"})}),(0,I.jsx)(v.VideoPopup,{isOpen:V})]})}},2449:function(e,n,t){t.r(n),t.d(n,{getCallHistory:function(){return o},initiateCall:function(){return s}});var r=t(9599),a=t(77),o=function(){return(0,r.axios)({url:a.endpoints.call.history,method:"get"})},s=function(e,n){return(0,r.axios)({url:"".concat(a.endpoints.call.initiate,"/").concat(e),method:"post",data:n})}},9855:function(e,n,t){t.r(n),t.d(n,{addToFavourite:function(){return c},createReaction:function(){return p},getChatById:function(){return s},getChatByType:function(){return o},getChatMessagesByMsgId:function(){return i},markAsRead:function(){return d},markAsReadByMsgId:function(){return l},removeFromFavourite:function(){return u},updateReaction:function(){return f}});var r=t(9599),a=t(77),o=function(e){return(0,r.axios)({url:"".concat(a.endpoints.chat.list,"/").concat(e),method:"get"})},s=function(e,n){return(0,r.axios)({url:"".concat(a.endpoints.chat.chatDetails,"/").concat(e),method:"get",params:n})},i=function(e,n,t){return(0,r.axios)({url:"".concat(a.endpoints.chat.chatMessages,"/").concat(e,"/").concat(n),method:"get",params:t})},c=function(e){return(0,r.axios)({url:a.endpoints.chat.addFavourite,method:"put"})},u=function(e){return(0,r.axios)({url:a.endpoints.chat.removeFavourite,method:"delete"})},l=function(e,n){return(0,r.axios)({url:"".concat(a.endpoints.chat.markAsReadByMsgId,"/").concat(e,"/").concat(n),method:"put"})},d=function(e){return(0,r.axios)({url:"".concat(a.endpoints.chat.markAsRead,"/").concat(e),method:"put"})},p=function(e){return(0,r.axios)({url:"".concat(a.endpoints.chat.createReaction),method:"post",data:e})},f=function(e){return(0,r.axios)({url:"".concat(a.endpoints.chat.updateReaction),method:"put",data:e})}},3537:function(e,n,t){t.r(n),t.d(n,{createMessage:function(){return o}});var r=t(9599),a=t(77),o=function(e,n){return(0,r.axios)({url:"".concat(a.endpoints.message.createMessage,"/").concat(e),method:"post",data:n})}},3487:function(e,n,t){t.r(n),t.d(n,{fileUpload:function(){return c},metaData:function(){return i}});var r=t(4165),a=t(5861),o=t(9599),s=t(77),i=(t(9930),function(e){var n;return(0,o.axios)({url:null===(n=s.endpoints.others)||void 0===n?void 0:n.metaData,method:"post",data:e})}),c=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.axios)({url:null===(t=s.endpoints.others)||void 0===t?void 0:t.fileUpload,method:"post",data:n}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},9599:function(e,n,t){t.r(n),t.d(n,{axios:function(){return i}});var r=t(4569),a=t.n(r),o=t(2703),s=t(77),i=a().create({baseURL:s.baseURL});i.interceptors.request.use((function(e){var n=(0,o.cookies)().get("authToken");return n&&(e.headers.Authorization=n),e}),(function(e){return Promise.reject(e)})),i.interceptors.response.use((function(e){return e}),(function(e){var n;return 401===e.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===e||void 0===e||null===(n=e.response)||void 0===n?void 0:n.data)}))},9961:function(e,n,t){t.r(n),n.default={chat_wrapper:"Chat_chat_wrapper__gid5u",chat_section:"Chat_chat_section__3JB1Y",chat_skeleton:"Chat_chat_skeleton__6w6um",reply_enter:"Chat_reply_enter__QdcSq","from-bottom":"Chat_from-bottom__yjlc1",reply_exit:"Chat_reply_exit__CEbB5",reply_container:"Chat_reply_container__Hj6fN",reply_card:"Chat_reply_card__6LYq6",close:"Chat_close__2-iqb",profile_sidebar:"Chat_profile_sidebar__DYbvp",typing:"Chat_typing__kJgMt","zoom-in":"Chat_zoom-in__p3vEB"}},8527:function(e,n,t){t.r(n),n.default={container:"Conversation_container__I7CJi",chat_wrapper:"Conversation_chat_wrapper__S3O8R",end:"Conversation_end__ZMbi5",chat_card:"Conversation_chat_card__jz70L",reply_card:"Conversation_reply_card__AEy90",msg_time:"Conversation_msg_time__wN53F",tick:"Conversation_tick__RkyEe",reactions:"Conversation_reactions__faDG2",user_name:"Conversation_user_name__RDhDd",clock:"Conversation_clock__y4n8i",options:"Conversation_options__WLSBI",date:"Conversation_date__ZfQTB",unread_msg:"Conversation_unread_msg__yFItk",section:"Conversation_section__wG88I",load:"Conversation_load__rqCbg"}},8263:function(e,n,t){t.r(n),n.default={container:"Reaction_container__yXj24",wrapper:"Reaction_wrapper__m5dkH"}},9041:function(e,n,t){t.r(n),n.default={chat_header:"Header_chat_header__QpmQQ",user_info:"Header_user_info__iEHZa",go_back:"Header_go_back__lCP4K",user_name:"Header_user_name__Trw38",chat_icons:"Header_chat_icons__JOz6D",show:"Header_show__F368n"}},67:function(e,n,t){t.r(n),n.default={loader:"Loader_loader__gQpe+",rotation:"Loader_rotation__Q-TX-"}},22:function(e,n,t){t.r(n),n.default={container:"PageLoader_container__WEvcy",card:"PageLoader_card__Fmr-Q",end:"PageLoader_end__ahXWd",line:"PageLoader_line__y70Cl"}},3693:function(e,n,t){t.r(n),n.default={popup:"ReactionPopup_popup__yt4AZ",reactions:"ReactionPopup_reactions__3HDB6",all:"ReactionPopup_all__nfaPI",card:"ReactionPopup_card__P+lgl",users:"ReactionPopup_users__81RJu"}},4302:function(e,n,t){t.r(n),n.default={popup:"SeenPopup_popup__d-7Be",reactions:"SeenPopup_reactions__DkyZZ",all:"SeenPopup_all__2FlpU",users:"SeenPopup_users__Ehebn",card:"SeenPopup_card__irnNc"}},517:function(e,n,t){t.r(n),n.default={emoji_enter:"Emoji_emoji_enter__hm4pK",emoji_container:"Emoji_emoji_container__FeFYJ",emoji_wrapper:"Emoji_emoji_wrapper__Mni-7","emoji-anime":"Emoji_emoji-anime__vboWK",emoji_exit:"Emoji_emoji_exit__yUFuv",emoji_header:"Emoji_emoji_header__HJTsc",emoji_type:"Emoji_emoji_type__Hmz-D",close:"Emoji_close__Tlf+A",search_emoji:"Emoji_search_emoji__QHZYs",search_icon:"Emoji_search_icon__EVS9p",emoji_card:"Emoji_emoji_card__cVAbK",emoji_title:"Emoji_emoji_title__uaqYB",emoji_list:"Emoji_emoji_list__zUunG",emoji_icon:"Emoji_emoji_icon__QGww2"}},8731:function(e,n,t){t.r(n),n.default={chat_input:"TextArea_chat_input__+dl6x",input_field:"TextArea_input_field__++nq-"}},2786:function(e,n,t){t.r(n),n.default={video_container:"VideoPopup_video_container__EcnPE",remote:"VideoPopup_remote__x1HvW",local:"VideoPopup_local__xIYkj"}},101:function(e,n,t){e.exports=t.p+"static/media/fade-in-tone.4355e6fe3e157d8945f6.mp3"},4329:function(e,n,t){e.exports=t.p+"static/media/favicon.6072f0ecd8b7685691ff.ico"}}]);
//# sourceMappingURL=7352.2108fd40.chunk.js.map