"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[8573,8815,9599,9855],{8573:function(t,e,a){a.r(e);var n=a(2982),s=a(4942),r=a(4165),c=a(1413),i=a(5861),u=a(885),o=a(2791),d=a(9930),l=a(2703),h=a(4717),m=a(9855),f=a(2426),p=a.n(f),v=a(9102),x=a(8815),g=a(184),_="recent",j="favourite",N="group";e.default=function(){var t=(0,h.useAuth)(),e=t.chatId,a=t.handleChat,f=(t.user,(0,o.useState)({recent:[],favourite:[],group:[]})),y=(0,u.Z)(f,2),Z=y[0],C=y[1],k=(0,o.useState)(!0),b=(0,u.Z)(k,2),A=b[0],F=b[1],S=Z.favourite,T=Z.recent,I=Z.group;(0,o.useEffect)((function(){return document.addEventListener("socket",w),L(),function(){document.removeEventListener("socket",w)}}),[]);var w=function(){v.socket.on("new-message",q),v.socket.on("start-typing",B),v.socket.on("end-typing",P)},L=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(){var e,a,n,s,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([(0,m.getChatByType)(_),(0,m.getChatByType)(j),(0,m.getChatByType)(N)]);case 3:e=t.sent,a=(0,u.Z)(e,3),n=a[0],s=a[1],i=a[2],C((0,c.Z)((0,c.Z)({},Z),{},{recent:n.data.data,favourite:s.data.data,group:i.data.data})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),(0,d.Toast)({type:"error",message:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 14:return t.prev=14,F(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),E=function(t,e,n){R(e,n),a(t)},R=function(t,e){C((function(a){var n=(0,c.Z)({},a);return n[t][e].count=0,n}))},q=function(t,e,a){var r=sessionStorage.getItem("chatId");C((function(i){var o=t.type,d=i[o].findIndex((function(e){return e._id===t._id}));if(-1===d)return t.count=1,(0,c.Z)((0,c.Z)({},i),{},(0,s.Z)({},o,[t]));var l=(0,n.Z)(i[o]),h=l.splice(d,1),m=(0,u.Z)(h,1)[0];return r===t._id||a===e?t.count=0:t.count=(m.count||0)+1,(0,c.Z)((0,c.Z)({},i),{},(0,s.Z)({},o,[t].concat((0,n.Z)(l))))}))},z=function(t){return t.split("T")[0]===(new Date).toISOString().split("T")[0]?p()(t).format("h:mm a"):p()(t).format("DD/MM/YY")},B=function(t,e){var a=document.querySelector("[chatid='".concat(t,"']"));a&&a.querySelector("[typingstatus]").setAttribute("typing","".concat(e.split(" ")[0]," is typing..."))},P=function(t){var e=document.querySelector("[chatid='".concat(t,"']"));e&&e.querySelector("[typingstatus]").removeAttribute("typing")};return A?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsxs)("div",{className:x.default.chat_list_container,children:[S.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)("div",{className:x.default.title,children:(0,g.jsx)("b",{children:"Favourites"})}),S.map((function(t,a){var n=t._id,r=t.count,c=t.latest,i=c.msg,u=c.date,o=t.user,h=o.name,m=o.avatar,f=o.status,p=o.id;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,s.Z)({},x.default.active,n===e)),onClick:function(){return E(n,j,a)},chatid:n,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:m,name:h,status:f,size:35,userId:p}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:h}),(0,g.jsx)("span",{className:"truncate-1",children:i})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,s.Z)({},x.default.top,!r)),children:[(0,g.jsx)("span",{children:z(u)}),r>0&&(0,g.jsx)("label",{children:r})]})]},a)}))]}),T.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)("div",{className:x.default.title,children:(0,g.jsx)("b",{children:"Recent Chats"})}),T.map((function(t,a){var n=t._id,r=t.count,c=t.latest,i=c.msg,u=c.date,o=t.user,h=o.name,m=o.avatar,f=o.status,p=o.id;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,s.Z)({},x.default.active,n===e)),onClick:function(){return E(n,_,a)},chatid:n,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:m,name:h,status:f,size:35,userId:p}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:h}),(0,g.jsx)("span",{className:"truncate-1",children:i})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,s.Z)({},x.default.top,!r)),children:[(0,g.jsx)("span",{children:z(u)}),r>0&&(0,g.jsx)("label",{children:r})]})]},a)}))]}),I.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsxs)("div",{className:x.default.title,children:[(0,g.jsx)("b",{children:"Groups"}),(0,g.jsx)("button",{children:(0,g.jsx)("i",{className:"bx-plus"})})]}),I.map((function(t,a){var n=t._id,r=t.count,c=t.latest,i=c.msg,u=c.date,o=t.group,h=o.name,m=o.avatar;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,s.Z)({},x.default.active,n===e)),onClick:function(){return E(n,N,a)},chatid:n,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:m,name:h,size:35}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:h}),(0,g.jsx)("span",{className:"truncate-1",children:i})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,s.Z)({},x.default.top,!r)),children:[(0,g.jsx)("span",{children:z(u)}),r>0&&(0,g.jsx)("label",{children:r})]})]},a)}))]})]})}},9855:function(t,e,a){a.r(e),a.d(e,{addToFavourite:function(){return i},getChatById:function(){return c},getChatByType:function(){return r},markAsRead:function(){return o},removeFromFavourite:function(){return u}});var n=a(9599),s=a(77),r=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.list,"/").concat(t),method:"get"})},c=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.chatDetails,"/").concat(t),method:"get"})},i=function(t){return(0,n.axios)({url:s.endpoints.chat.addFavourite,method:"put"})},u=function(t){return(0,n.axios)({url:s.endpoints.chat.removeFavourite,method:"delete"})},o=function(t,e){return(0,n.axios)({url:"".concat(s.endpoints.chat.markAsRead,"/").concat(t),method:"put",data:e})}},9599:function(t,e,a){a.r(e),a.d(e,{axios:function(){return i}});var n=a(4569),s=a.n(n),r=a(2703),c=a(77),i=s().create({baseURL:c.baseURL});i.interceptors.request.use((function(t){var e=(0,r.cookies)().get("authToken");return e&&(t.headers.Authorization=e),t}),(function(t){return Promise.reject(t)})),i.interceptors.response.use((function(t){return t}),(function(t){var e;return 401===t.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.data)}))},8815:function(t,e,a){a.r(e),e.default={chat_list_container:"Chats_chat_list_container__Lo8ht",title:"Chats_title__ncpOR",user_card:"Chats_user_card__m+jOS",active:"Chats_active__07HzW",user:"Chats_user__LeGpu",msg:"Chats_msg__y5EF6",time:"Chats_time__hAPQQ",top:"Chats_top__dpX3P"}}}]);
//# sourceMappingURL=8573.63bf43f9.chunk.js.map