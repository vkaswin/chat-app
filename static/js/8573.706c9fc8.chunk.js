"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[8573,8815,9599,9855],{8573:function(t,e,a){a.r(e);var n=a(2982),s=a(4942),r=a(4165),c=a(1413),i=a(5861),u=a(885),o=a(2791),d=a(9930),l=a(2703),h=a(4717),m=a(9855),f=a(2426),p=a.n(f),v=a(9102),x=a(8815),g=a(184);e.default=function(){var t=(0,h.useAuth)(),e=t.chatId,a=t.handleChat,f=(t.user,(0,o.useState)({recent:[],favourite:[],group:[]})),_=(0,u.Z)(f,2),j=_[0],N=_[1],C=(0,o.useState)(!0),Z=(0,u.Z)(C,2),y=Z[0],k=Z[1],b=j.favourite,F=j.recent,A=j.group;(0,o.useEffect)((function(){return document.addEventListener("socket",I),S(),function(){document.removeEventListener("socket",I)}}),[]);var I=function(){v.socket.on("new-message",R),v.socket.on("start-typing",L),v.socket.on("end-typing",E)},S=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(){var e,a,n,s,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([(0,m.getRecentChats)(),(0,m.getFavouriteChats)(),(0,m.getGroupChats)()]);case 3:e=t.sent,a=(0,u.Z)(e,3),n=a[0],s=a[1],i=a[2],N((0,c.Z)((0,c.Z)({},j),{},{recent:n.data.data,favourite:s.data.data,group:i.data.data})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),(0,d.Toast)({type:"error",message:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 14:return t.prev=14,k(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),R=function(t,e,a){var r=sessionStorage.getItem("chatId");N((function(i){var o=t.type,d=i[o].findIndex((function(e){return e._id===t._id}));if(-1===d)return t.count=1,(0,c.Z)((0,c.Z)({},i),{},(0,s.Z)({},o,[t]));var l=(0,n.Z)(i[o]),h=l.splice(d,1),m=(0,u.Z)(h,1)[0];return r===t._id||a===e?t.count=0:t.count=m.count+1,(0,c.Z)((0,c.Z)({},i),{},(0,s.Z)({},o,[t].concat((0,n.Z)(l))))}))},w=function(t){return t.split("T")[0]===(new Date).toISOString().split("T")[0]?p()(t).format("h:mm a"):p()(t).format("DD/MM/YY")},L=function(t,e){var a=document.querySelector("[chatid='".concat(t,"']"));a&&a.querySelector("[typingstatus]").setAttribute("typing","".concat(e.split(" ")[0]," is typing..."))},E=function(t){var e=document.querySelector("[chatid='".concat(t,"']"));e&&e.querySelector("[typingstatus]").removeAttribute("typing")};return y?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsxs)("div",{className:x.default.chat_list_container,children:[b.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)("div",{className:x.default.title,children:(0,g.jsx)("b",{children:"Favourites"})}),b.map((function(t,n){var r=t._id,c=t.count,i=t.msg,u=t.date,o=t.name,h=t.avatar,m=t.status,f=t.userId;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,s.Z)({},x.default.active,r===e)),onClick:function(){return a(r)},chatid:r,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:h,name:o,status:m,size:35,userId:f}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:o}),(0,g.jsx)("span",{className:"truncate-1",children:i})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,s.Z)({},x.default.top,!c)),children:[(0,g.jsx)("span",{children:w(u)}),c>0&&(0,g.jsx)("label",{children:c})]})]},n)}))]}),F.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)("div",{className:x.default.title,children:(0,g.jsx)("b",{children:"Recent Chats"})}),F.map((function(t,n){var r=t._id,c=t.count,i=t.msg,u=t.date,o=t.name,h=t.avatar,m=t.status,f=t.userId;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,s.Z)({},x.default.active,r===e)),onClick:function(){return a(r)},chatid:r,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:h,name:o,status:m,size:35,userId:f}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:o}),(0,g.jsx)("span",{className:"truncate-1",children:i})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,s.Z)({},x.default.top,!c)),children:[(0,g.jsx)("span",{children:w(u)}),c>0&&(0,g.jsx)("label",{children:c})]})]},n)}))]}),A.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsxs)("div",{className:x.default.title,children:[(0,g.jsx)("b",{children:"Groups"}),(0,g.jsx)("button",{children:(0,g.jsx)("i",{className:"bx-plus"})})]}),A.map((function(t,n){var r=t._id,c=t.count,i=t.msg,u=t.date,o=t.name,h=t.avatar;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,s.Z)({},x.default.active,r===e)),onClick:function(){return a(r)},chatid:r,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:h,name:o,size:35}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:o}),(0,g.jsx)("span",{className:"truncate-1",children:i})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,s.Z)({},x.default.top,!c)),children:[(0,g.jsx)("span",{children:w(u)}),c>0&&(0,g.jsx)("label",{children:c})]})]},n)}))]})]})}},9855:function(t,e,a){a.r(e),a.d(e,{addToFavourite:function(){return o},getChatById:function(){return u},getFavouriteChats:function(){return c},getGroupChats:function(){return i},getRecentChats:function(){return r},markAsRead:function(){return l},removeFromFavourite:function(){return d}});var n=a(9599),s=a(77),r=function(){return(0,n.axios)({url:s.endpoints.chat.recentChats,method:"get"})},c=function(){return(0,n.axios)({url:s.endpoints.chat.favouriteChats,method:"get"})},i=function(){return(0,n.axios)({url:s.endpoints.chat.groupChats,method:"get"})},u=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.chatDetails,"/").concat(t),method:"get"})},o=function(t){return(0,n.axios)({url:s.endpoints.chat.addFavourite,method:"put"})},d=function(t){return(0,n.axios)({url:s.endpoints.chat.removeFavourite,method:"delete"})},l=function(t,e){return(0,n.axios)({url:"".concat(s.endpoints.chat.markAsRead,"/").concat(t),method:"put",data:e})}},9599:function(t,e,a){a.r(e),a.d(e,{axios:function(){return i}});var n=a(4569),s=a.n(n),r=a(2703),c=a(77),i=s().create({baseURL:c.baseURL});i.interceptors.request.use((function(t){var e=(0,r.cookies)().get("authToken");return e&&(t.headers.Authorization=e),t}),(function(t){return Promise.reject(t)})),i.interceptors.response.use((function(t){return t}),(function(t){var e;return 401===t.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.data)}))},8815:function(t,e,a){a.r(e),e.default={chat_list_container:"Chats_chat_list_container__Lo8ht",title:"Chats_title__ncpOR",user_card:"Chats_user_card__m+jOS",active:"Chats_active__07HzW",user:"Chats_user__LeGpu",msg:"Chats_msg__y5EF6",time:"Chats_time__hAPQQ",top:"Chats_top__dpX3P"}}}]);
//# sourceMappingURL=8573.706c9fc8.chunk.js.map