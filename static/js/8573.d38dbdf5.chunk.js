"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[8573,8815,9599,9855],{8573:function(t,e,a){a.r(e);var n=a(2982),s=a(4942),r=a(4165),c=a(1413),i=a(5861),u=a(885),o=a(2791),d=a(9930),l=a(2703),h=a(4717),m=a(9855),f=a(2426),p=a.n(f),v=a(9102),g=a(8815),x=a(184),_="recent",j="favourite",y="group";e.default=function(){var t=(0,h.useAuth)(),e=t.chatId,a=t.handleChat,f=(0,o.useState)({recent:[],favourite:[],group:[]}),N=(0,u.Z)(f,2),Z=N[0],C=N[1],k=(0,o.useState)(!0),b=(0,u.Z)(k,2),A=b[0],R=b[1],I=Z.favourite,F=Z.recent,S=Z.group;(0,o.useEffect)((function(){return document.addEventListener("socket",T),B(),function(){document.removeEventListener("socket",T)}}),[]);var T=function(){v.socket.on("message",w),v.socket.on("start-typing",q),v.socket.on("end-typing",z)},B=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(){var e,a,n,s,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([(0,m.getChatByType)(_),(0,m.getChatByType)(j),(0,m.getChatByType)(y)]);case 3:e=t.sent,a=(0,u.Z)(e,3),n=a[0],s=a[1],i=a[2],C((0,c.Z)((0,c.Z)({},Z),{},{recent:n.data.data,favourite:s.data.data,group:i.data.data})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),(0,d.Toast)({type:"error",message:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 14:return t.prev=14,R(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),L=function(t,e,n){M(e,n),a(t)},M=function(t,e){C((function(a){var n=(0,c.Z)({},a);return n[t][e].count=0,n}))},w=function(t){var e=t.message,a=e.msg,r=e.date,i=e.sender,o=t.chat,d=o._id,l=o.group,h=o.favourites,m=o.users,f=t.userId,p=!!l,v=(0,c.Z)({msg:a,date:r,_id:d},p?{group:{name:l.name,avatar:l.avatar}}:{user:m.find((function(t){return t._id!==f}))});C((function(t){var e=p?"group":h.includes(f)?"favourite":"recent",a=t[e].findIndex((function(t){return t._id===d}));if(-1===a)return v.count=1,(0,c.Z)((0,c.Z)({},t),{},(0,s.Z)({},e,[v]));var r=(0,n.Z)(t[e]),o=r.splice(a,1),l=(0,u.Z)(o,1)[0];return d===sessionStorage.getItem("chatId")||f===i.id?v.count=0:v.count=(l.count||0)+1,(0,c.Z)((0,c.Z)({},t),{},(0,s.Z)({},e,[v].concat((0,n.Z)(r))))}))},E=function(t){return t.split("T")[0]===(new Date).toISOString().split("T")[0]?p()(t).format("h:mm a"):p()(t).format("DD/MM/YY")},q=function(t,e){var a=document.querySelector("[chatid='".concat(t,"']"));a&&a.querySelector("[typingstatus]").setAttribute("typing","".concat(e.split(" ")[0]," is typing..."))},z=function(t){var e=document.querySelector("[chatid='".concat(t,"']"));e&&e.querySelector("[typingstatus]").removeAttribute("typing")};return A?(0,x.jsx)("div",{children:"Loading..."}):(0,x.jsxs)("div",{className:g.default.chat_list_container,children:[I.length>0&&(0,x.jsxs)(o.Fragment,{children:[(0,x.jsx)("div",{className:g.default.title,children:(0,x.jsx)("b",{children:"Favourites"})}),I.map((function(t,a){var n=t._id,r=t.count,c=t.msg,i=t.date,u=t.user,o=u.name,h=u.avatar,m=u.status,f=u.id;return(0,x.jsxs)("div",{className:(0,l.classNames)(g.default.user_card,(0,s.Z)({},g.default.active,n===e)),onClick:function(){return L(n,j,a)},chatid:n,children:[(0,x.jsxs)("div",{className:g.default.user,children:[(0,x.jsx)(d.Avatar,{src:h,name:o,status:m,size:35,userId:f}),(0,x.jsxs)("div",{className:g.default.msg,typingstatus:"",children:[(0,x.jsx)("span",{className:"truncate-1",children:o}),(0,x.jsx)("span",{className:"truncate-1",children:c})]})]}),(0,x.jsxs)("div",{className:(0,l.classNames)(g.default.time,(0,s.Z)({},g.default.top,!r)),children:[(0,x.jsx)("span",{children:E(i)}),r>0&&(0,x.jsx)("label",{children:r})]})]},a)}))]}),F.length>0&&(0,x.jsxs)(o.Fragment,{children:[(0,x.jsx)("div",{className:g.default.title,children:(0,x.jsx)("b",{children:"Recent Chats"})}),F.map((function(t,a){var n=t._id,r=t.count,c=t.msg,i=t.date,u=t.user,o=u.name,h=u.avatar,m=u.status,f=u.id;return(0,x.jsxs)("div",{className:(0,l.classNames)(g.default.user_card,(0,s.Z)({},g.default.active,n===e)),onClick:function(){return L(n,_,a)},chatid:n,children:[(0,x.jsxs)("div",{className:g.default.user,children:[(0,x.jsx)(d.Avatar,{src:h,name:o,status:m,size:35,userId:f}),(0,x.jsxs)("div",{className:g.default.msg,typingstatus:"",children:[(0,x.jsx)("span",{className:"truncate-1",children:o}),(0,x.jsx)("span",{className:"truncate-1",children:c})]})]}),(0,x.jsxs)("div",{className:(0,l.classNames)(g.default.time,(0,s.Z)({},g.default.top,!r)),children:[(0,x.jsx)("span",{children:E(i)}),r>0&&(0,x.jsx)("label",{children:r})]})]},a)}))]}),S.length>0&&(0,x.jsxs)(o.Fragment,{children:[(0,x.jsxs)("div",{className:g.default.title,children:[(0,x.jsx)("b",{children:"Groups"}),(0,x.jsx)("button",{children:(0,x.jsx)("i",{className:"bx-plus"})})]}),S.map((function(t,a){var n=t._id,r=t.count,c=t.msg,i=t.date,u=t.group,o=u.name,h=u.avatar;return(0,x.jsxs)("div",{className:(0,l.classNames)(g.default.user_card,(0,s.Z)({},g.default.active,n===e)),onClick:function(){return L(n,y,a)},chatid:n,children:[(0,x.jsxs)("div",{className:g.default.user,children:[(0,x.jsx)(d.Avatar,{src:h,name:o,size:35}),(0,x.jsxs)("div",{className:g.default.msg,typingstatus:"",children:[(0,x.jsx)("span",{className:"truncate-1",children:o}),(0,x.jsx)("span",{className:"truncate-1",children:c})]})]}),(0,x.jsxs)("div",{className:(0,l.classNames)(g.default.time,(0,s.Z)({},g.default.top,!r)),children:[(0,x.jsx)("span",{children:E(i)}),r>0&&(0,x.jsx)("label",{children:r})]})]},a)}))]})]})}},9855:function(t,e,a){a.r(e),a.d(e,{addToFavourite:function(){return u},createReaction:function(){return m},getAllReactions:function(){return h},getChatById:function(){return c},getChatByType:function(){return r},getChatMessagesByMsgId:function(){return i},markAsRead:function(){return l},markAsReadByMsgId:function(){return d},removeFromFavourite:function(){return o},updateReaction:function(){return f}});var n=a(9599),s=a(77),r=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.list,"/").concat(t),method:"get"})},c=function(t,e){return(0,n.axios)({url:"".concat(s.endpoints.chat.chatDetails,"/").concat(t),method:"get",params:e})},i=function(t,e,a){return(0,n.axios)({url:"".concat(s.endpoints.chat.chatMessages,"/").concat(t,"/").concat(e),method:"get",params:a})},u=function(t){return(0,n.axios)({url:s.endpoints.chat.addFavourite,method:"put"})},o=function(t){return(0,n.axios)({url:s.endpoints.chat.removeFavourite,method:"delete"})},d=function(t,e){return(0,n.axios)({url:"".concat(s.endpoints.chat.markAsReadByMsgId,"/").concat(t,"/").concat(e),method:"put"})},l=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.markAsRead,"/").concat(t),method:"put"})},h=function(){return(0,n.axios)({url:"".concat(s.endpoints.chat.reactions),method:"get"})},m=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.createReaction),method:"post",data:t})},f=function(t){return(0,n.axios)({url:"".concat(s.endpoints.chat.updateReaction),method:"put",data:t})}},9599:function(t,e,a){a.r(e),a.d(e,{axios:function(){return i}});var n=a(4569),s=a.n(n),r=a(2703),c=a(77),i=s().create({baseURL:c.baseURL});i.interceptors.request.use((function(t){var e=(0,r.cookies)().get("authToken");return e&&(t.headers.Authorization=e),t}),(function(t){return Promise.reject(t)})),i.interceptors.response.use((function(t){return t}),(function(t){var e;return 401===t.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.data)}))},8815:function(t,e,a){a.r(e),e.default={chat_list_container:"Chats_chat_list_container__Lo8ht",title:"Chats_title__ncpOR",user_card:"Chats_user_card__m+jOS",active:"Chats_active__07HzW",user:"Chats_user__LeGpu",msg:"Chats_msg__y5EF6",time:"Chats_time__hAPQQ",top:"Chats_top__dpX3P"}}}]);
//# sourceMappingURL=8573.d38dbdf5.chunk.js.map