"use strict";(self.webpackChunkchat_app=self.webpackChunkchat_app||[]).push([[8573,8354,4653,9599,9855],{8354:function(t,e,n){n.r(e);var a=n(4942),r=n(2791),c=n(9930),o=n(2703),u=n(2426),s=n.n(u),i=n(4653),d=n(184);e.default=function(t){var e=t.title,n=t.list,u=t.handleClick,l=t.type,f=t.chatId,h=function(t){return t.split("T")[0]===(new Date).toISOString().split("T")[0]?s()(t).format("h:mm a"):s()(t).format("DD/MM/YY")};return(0,d.jsxs)(r.Fragment,{children:[(0,d.jsx)("div",{className:i.default.title,children:(0,d.jsx)("b",{children:e.padEnd(e.length+1,"s")})}),n.map((function(t,e){var n=t._id,r=t.count,s=t.msg,p=t.date,m=t.name,v=t.avatar,g=t.status,C=t.userId,_=t.colorCode;return(0,d.jsxs)("div",{className:(0,o.classNames)(i.default.user_card,(0,a.Z)({},i.default.active,n===f)),onClick:function(){return u(n,l,e)},chatid:n,children:[(0,d.jsxs)("div",{className:i.default.user,children:[(0,d.jsx)(c.Avatar,{src:v||_,name:m,status:g,size:35,userId:C}),(0,d.jsxs)("div",{className:i.default.msg,typingstatus:"",children:[(0,d.jsx)("span",{className:"truncate-1",children:m}),(0,d.jsx)("span",{className:"truncate-1",children:s})]})]}),(0,d.jsxs)("div",{className:(0,o.classNames)(i.default.time,(0,a.Z)({},i.default.top,!r)),children:[(0,d.jsx)("span",{children:h(p)}),r>0&&(0,d.jsx)("label",{children:r})]})]},e)}))]})}},8573:function(t,e,n){n.r(e);var a=n(2982),r=n(4942),c=n(4165),o=n(1413),u=n(5861),s=n(885),i=n(2791),d=n(9930),l=n(4717),f=n(9855),h=n(9102),p=n(8354),m=n(184),v="recent",g="favourite",C="group";e.default=function(){var t=(0,l.useAuth)(),e=t.chatId,n=t.handleChat,_=(0,i.useState)({favourite:[],recent:[],group:[]}),x=(0,s.Z)(_,2),y=x[0],Z=x[1],k=(0,i.useState)(!0),j=(0,s.Z)(k,2),I=j[0],S=j[1],b=(0,i.useState)(""),B=(0,s.Z)(b,2),A=B[0],M=B[1];(0,i.useEffect)((function(){return document.addEventListener("socket",R),w(),function(){document.removeEventListener("socket",R)}}),[]);var R=function(){h.socket.on("message",T),h.socket.on("start-typing",F),h.socket.on("end-typing",E),h.socket.on("favourite",D)},w=function(){var t=(0,u.Z)((0,c.Z)().mark((function t(){var e,n,a,r,u;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([(0,f.getChatByType)(v),(0,f.getChatByType)(g),(0,f.getChatByType)(C)]);case 3:e=t.sent,n=(0,s.Z)(e,3),a=n[0],r=n[1],u=n[2],Z((0,o.Z)((0,o.Z)({},y),{},{recent:a.data.data,favourite:r.data.data,group:u.data.data})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),(0,d.Toast)({type:"error",message:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 14:return t.prev=14,S(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),L=function(t,e,a){N(e,a),n(t)},N=function(t,e){Z((function(n){var a=(0,o.Z)({},n);return a[t][e].count=0,a}))},T=function(t){var e=t.message,n=e.msg,c=e.date,u=e.sender,i=t.chat,d=i._id,l=i.group,f=i.favourites,h=i.user,p=t.userId,m=!!l,v=(0,o.Z)({msg:n,date:c,_id:d},m?{name:l.name,avatar:l.avatar,colorCode:l.colorCode}:(0,o.Z)({},h));Z((function(t){var e=m?"group":f.includes(p)?"favourite":"recent",n=t[e].findIndex((function(t){return t._id===d}));if(-1===n)return v.count=1,(0,o.Z)((0,o.Z)({},t),{},(0,r.Z)({},e,[v]));var c=(0,a.Z)(t[e]),i=c.splice(n,1),l=(0,s.Z)(i,1)[0];return d===sessionStorage.getItem("chatId")||p===u._id?v.count=0:v.count=(l.count||0)+1,(0,o.Z)((0,o.Z)({},t),{},(0,r.Z)({},e,[v].concat((0,a.Z)(c))))}))},D=function(t,e,n){Z((function(a){var r=n?"group":"recent",c=(0,o.Z)({},a);if(e){c.favourite.unshift(t);var u=c[r].findIndex((function(e){var n=e._id;return t._id===n}));if(u<0)return;c[r].splice(u,1)}else{var s=c.favourite.findIndex((function(e){var n=e._id;return t._id===n}));if(s<0)return;c.favourite.splice(s,1)}return c}))},F=function(t,e){var n=document.querySelector("[chatid='".concat(t,"']"));n&&n.querySelector("[typingstatus]").setAttribute("typing","".concat(e.split(" ")[0]," is typing..."))},E=function(t){var e=document.querySelector("[chatid='".concat(t,"']"));e&&e.querySelector("[typingstatus]").removeAttribute("typing")},q=(0,i.useMemo)((function(){return 0===A.length?y:Object.entries(y).reduce((function(t,e){var n=(0,s.Z)(e,2),a=n[0],r=n[1];return t[a]=r.filter((function(t){return t.name.toLowerCase().includes(A.toLocaleLowerCase())})),t}),{})}),[A,y]);return I?(0,m.jsx)("div",{children:"Loading..."}):(0,m.jsxs)(i.Fragment,{children:[(0,m.jsx)(d.SearchBox,{title:"Chats",placeholder:"Search here...",onChange:function(t){var e=t.target.value;M(0===e.length?"":e)}}),Object.entries(q).map((function(t,n){var a=(0,s.Z)(t,2),r=a[0],c=a[1];return(0,m.jsx)(p.default,{title:r,list:c,type:r,chatId:e,handleClick:L},n)}))]})}},9855:function(t,e,n){n.r(e),n.d(e,{addToFavourite:function(){return s},getChatById:function(){return o},getChatByType:function(){return c},getChatId:function(){return h},getChatMessageByRange:function(){return p},getChatMessagesByMsgId:function(){return u},markAsRead:function(){return l},markAsReadByMsgId:function(){return d},removeFromFavourite:function(){return i},sendReaction:function(){return f}});var a=n(9599),r=n(77),c=function(t){return(0,a.axios)({url:"".concat(r.endpoints.chat.list,"/").concat(t),method:"get"})},o=function(t,e){return(0,a.axios)({url:"".concat(r.endpoints.chat.chatDetails,"/").concat(t),method:"get",params:e})},u=function(t,e,n){return(0,a.axios)({url:"".concat(r.endpoints.chat.chatMessages,"/").concat(t,"/").concat(e),method:"get",params:n})},s=function(t){return(0,a.axios)({url:"".concat(r.endpoints.chat.addFavourite,"/").concat(t),method:"put"})},i=function(t){return(0,a.axios)({url:"".concat(r.endpoints.chat.removeFavourite,"/").concat(t),method:"delete"})},d=function(t,e){return(0,a.axios)({url:"".concat(r.endpoints.chat.markAsReadByMsgId,"/").concat(t,"/").concat(e),method:"put"})},l=function(t){return(0,a.axios)({url:"".concat(r.endpoints.chat.markAsRead,"/").concat(t),method:"put"})},f=function(t,e){return(0,a.axios)({url:"".concat(r.endpoints.chat.sendReaction,"/").concat(t),method:"post",data:e})},h=function(t){return(0,a.axios)({url:"".concat(r.endpoints.chat.getChatId,"/").concat(t),method:"get"})},p=function(t,e){return(0,a.axios)({url:"".concat(r.endpoints.chat.chatMessageByRange,"/").concat(t),method:"get",params:e})}},9599:function(t,e,n){n.r(e),n.d(e,{axios:function(){return u}});var a=n(4569),r=n.n(a),c=n(2703),o=n(77),u=r().create({baseURL:o.baseURL});u.interceptors.request.use((function(t){var e=(0,c.cookies)().get("auth_token");return e&&(t.headers.Authorization=e),t}),(function(t){return Promise.reject(t)})),u.interceptors.response.use((function(t){return t}),(function(t){var e;return 401===t.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.data)}))},4653:function(t,e,n){n.r(e),e.default={title:"ChatCard_title__0n9Lv",user_card:"ChatCard_user_card__8uDum",active:"ChatCard_active__Gepsm",user:"ChatCard_user__DAwIV",msg:"ChatCard_msg__T-C59",time:"ChatCard_time__H+Dke",top:"ChatCard_top__cWzoa"}}}]);
//# sourceMappingURL=8573.db718548.chunk.js.map