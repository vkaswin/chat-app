"use strict";(self.webpackChunkreact_chat_app=self.webpackChunkreact_chat_app||[]).push([[8573,8815,9599,9855],{8573:function(t,e,a){a.r(e);var s=a(2982),n=a(4942),r=a(4165),c=a(1413),i=a(5861),u=a(885),o=a(2791),d=a(9930),l=a(2703),h=a(4717),m=a(9855),f=a(2426),p=a.n(f),v=a(9102),x=a(8815),g=a(184),_="recent",j="favourite",N="group";e.default=function(){var t=(0,h.useAuth)(),e=t.chatId,a=t.handleChat,f=(t.user,(0,o.useState)({recent:[],favourite:[],group:[]})),y=(0,u.Z)(f,2),Z=y[0],C=y[1],k=(0,o.useState)(!0),b=(0,u.Z)(k,2),A=b[0],F=b[1],S=Z.favourite,T=Z.recent,I=Z.group;(0,o.useEffect)((function(){return document.addEventListener("socket",w),L(),function(){document.removeEventListener("socket",w)}}),[]);var w=function(){v.socket.on("new-message",E),v.socket.on("start-typing",q),v.socket.on("end-typing",z)},L=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(){var e,a,s,n,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([(0,m.getChatByType)(_),(0,m.getChatByType)(j),(0,m.getChatByType)(N)]);case 3:e=t.sent,a=(0,u.Z)(e,3),s=a[0],n=a[1],i=a[2],C((0,c.Z)((0,c.Z)({},Z),{},{recent:s.data.data,favourite:n.data.data,group:i.data.data})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),(0,d.Toast)({type:"error",message:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 14:return t.prev=14,F(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),E=function(t,e,a){var r=sessionStorage.getItem("chatId");C((function(i){var o=t.type,d=i[o].findIndex((function(e){return e._id===t._id}));if(-1===d)return t.count=1,(0,c.Z)((0,c.Z)({},i),{},(0,n.Z)({},o,[t]));var l=(0,s.Z)(i[o]),h=l.splice(d,1),m=(0,u.Z)(h,1)[0];return r===t._id||a===e?t.count=0:t.count=m.count+1,(0,c.Z)((0,c.Z)({},i),{},(0,n.Z)({},o,[t].concat((0,s.Z)(l))))}))},R=function(t){return t.split("T")[0]===(new Date).toISOString().split("T")[0]?p()(t).format("h:mm a"):p()(t).format("DD/MM/YY")},q=function(t,e){var a=document.querySelector("[chatid='".concat(t,"']"));a&&a.querySelector("[typingstatus]").setAttribute("typing","".concat(e.split(" ")[0]," is typing..."))},z=function(t){var e=document.querySelector("[chatid='".concat(t,"']"));e&&e.querySelector("[typingstatus]").removeAttribute("typing")};return A?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsxs)("div",{className:x.default.chat_list_container,children:[S.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)("div",{className:x.default.title,children:(0,g.jsx)("b",{children:"Favourites"})}),S.map((function(t,s){var r=t._id,c=t.count,i=t.latest,u=i.msg,o=i.date,h=t.user,m=h.name,f=h.avatar,p=h.status,v=h.id;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,n.Z)({},x.default.active,r===e)),onClick:function(){return a(r)},chatid:r,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:f,name:m,status:p,size:35,userId:v}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:m}),(0,g.jsx)("span",{className:"truncate-1",children:u})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,n.Z)({},x.default.top,!c)),children:[(0,g.jsx)("span",{children:R(o)}),c>0&&(0,g.jsx)("label",{children:c})]})]},s)}))]}),T.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)("div",{className:x.default.title,children:(0,g.jsx)("b",{children:"Recent Chats"})}),T.map((function(t,s){var r=t._id,c=t.count,i=t.latest,u=i.msg,o=i.date,h=t.user,m=h.name,f=h.avatar,p=h.status,v=h.id;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,n.Z)({},x.default.active,r===e)),onClick:function(){return a(r)},chatid:r,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:f,name:m,status:p,size:35,userId:v}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:m}),(0,g.jsx)("span",{className:"truncate-1",children:u})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,n.Z)({},x.default.top,!c)),children:[(0,g.jsx)("span",{children:R(o)}),c>0&&(0,g.jsx)("label",{children:c})]})]},s)}))]}),I.length>0&&(0,g.jsxs)(o.Fragment,{children:[(0,g.jsxs)("div",{className:x.default.title,children:[(0,g.jsx)("b",{children:"Groups"}),(0,g.jsx)("button",{children:(0,g.jsx)("i",{className:"bx-plus"})})]}),I.map((function(t,s){var r=t._id,c=t.count,i=t.latest,u=i.msg,o=i.date,h=t.group,m=h.name,f=h.avatar;return(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.user_card,(0,n.Z)({},x.default.active,r===e)),onClick:function(){return a(r)},chatid:r,children:[(0,g.jsxs)("div",{className:x.default.user,children:[(0,g.jsx)(d.Avatar,{src:f,name:m,size:35}),(0,g.jsxs)("div",{className:x.default.msg,typingstatus:"",children:[(0,g.jsx)("span",{className:"truncate-1",children:m}),(0,g.jsx)("span",{className:"truncate-1",children:u})]})]}),(0,g.jsxs)("div",{className:(0,l.classNames)(x.default.time,(0,n.Z)({},x.default.top,!c)),children:[(0,g.jsx)("span",{children:R(o)}),c>0&&(0,g.jsx)("label",{children:c})]})]},s)}))]})]})}},9855:function(t,e,a){a.r(e),a.d(e,{addToFavourite:function(){return i},getChatById:function(){return c},getChatByType:function(){return r},markAsRead:function(){return o},removeFromFavourite:function(){return u}});var s=a(9599),n=a(77),r=function(t){return(0,s.axios)({url:"".concat(n.endpoints.chat.list,"/").concat(t),method:"get"})},c=function(t){return(0,s.axios)({url:"".concat(n.endpoints.chat.chatDetails,"/").concat(t),method:"get"})},i=function(t){return(0,s.axios)({url:n.endpoints.chat.addFavourite,method:"put"})},u=function(t){return(0,s.axios)({url:n.endpoints.chat.removeFavourite,method:"delete"})},o=function(t,e){return(0,s.axios)({url:"".concat(n.endpoints.chat.markAsRead,"/").concat(t),method:"put",data:e})}},9599:function(t,e,a){a.r(e),a.d(e,{axios:function(){return i}});var s=a(4569),n=a.n(s),r=a(2703),c=a(77),i=n().create({baseURL:c.baseURL});i.interceptors.request.use((function(t){var e=(0,r.cookies)().get("authToken");return e&&(t.headers.Authorization=e),t}),(function(t){return Promise.reject(t)})),i.interceptors.response.use((function(t){return t}),(function(t){var e;return 401===t.response.status&&document.dispatchEvent(new CustomEvent("logout")),Promise.reject(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.data)}))},8815:function(t,e,a){a.r(e),e.default={chat_list_container:"Chats_chat_list_container__Lo8ht",title:"Chats_title__ncpOR",user_card:"Chats_user_card__m+jOS",active:"Chats_active__07HzW",user:"Chats_user__LeGpu",msg:"Chats_msg__y5EF6",time:"Chats_time__hAPQQ",top:"Chats_top__dpX3P"}}}]);
//# sourceMappingURL=8573.df1cf48e.chunk.js.map